System.register("chunks:///_virtual/AutoFollowTargetPosition.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var o,e,r,i,n,s;return{setters:[function(t){o=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){r=t.cclegacy,i=t.Node,n=t._decorator,s=t.Component}],execute:function(){var a,l,u,c,p;r._RF.push({},"bd71bW96ONFYr09uOe5J+XC","AutoFollowTargetPosition",void 0);const{ccclass:d,property:g}=n;t("AutoFollowTargetPosition",(a=d("AutoFollowTargetPosition"),l=g(i),a((p=o((c=class extends s{constructor(...t){super(...t),e(this,"targetNode",p,this)}start(){}update(t){this.targetNode&&this.node.setPosition(this.targetNode.position)}}).prototype,"targetNode",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=c))||u));r._RF.pop()}}}));

System.register("chunks:///_virtual/BaseRenderLayer.ts",["cc","./DanmakuData.ts","./DanmakuUtils.ts"],(function(e){var t,o,n,i,r;return{setters:[function(e){t=e.cclegacy,o=e.Component},function(e){n=e.LAYER_TYPE_UNDEFINE,i=e.danmaDirection},function(e){r=e.DanmakuUtils}],execute:function(){t._RF.push({},"552d2YkTZZG5Ya93oRGkktx","BaseRenderLayer",void 0);e("BaseRenderLayer",class extends o{constructor(...e){super(...e),this.mController=void 0,this.mWidth=void 0,this.mHeight=void 0,this.mInitWidth=void 0,this.mInitHeight=void 0,this.mCachePoolList=void 0}onLayoutSizeChanged(e,t){}getRootNode(){return this.node}typesetting(e,t,o){throw new Error("Method not implemented.")}init(e,t){this.mController=e,this.mCachePoolList=t}releaseItem(e){if(e.recyclable()){e.onRecycle(),e.node.removeFromParent(),e.node.active=!1;let t=e.getData(),o=r.getPrefabIndex(t);this.mCachePoolList[o].add(e.node)}else e.node.removeFromParent(),e.node.destroy();e.onRelease()}clear(){}addItems(e,t){}getLayerType(){return n}getDirection(){return i.R_TO_L}updateOpacity(e){}}),t._RF.pop()}}}));

System.register("chunks:///_virtual/BoomAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StringUtils.ts"],(function(t){var n,i,e,o,s,r,a,l,c,m;return{setters:[function(t){n=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){e=t.cclegacy,o=t.Sprite,s=t.Label,r=t._decorator,a=t.Component,l=t.Animation,c=t.UITransform},function(t){m=t.StringUtils}],execute:function(){var u,h,p,g,d,y,b,f,A,B;e._RF.push({},"aa9d9AWilpDX6Sxtn05Hoa6","BoomAnimation",void 0);const{ccclass:P,property:S}=r;t("BoomAnimation",(u=P("BoomAnimation"),h=S(o),p=S(s),g=S(o),u(((B=class t extends a{constructor(...t){super(...t),this.mPlaying=!1,i(this,"boomAnim",b,this),i(this,"mText",f,this),i(this,"mBackground",A,this)}static getInstance(){return this._instance}onLoad(){t._instance=this}start(){this.node.active=!1,this.boomAnim.getComponent(l).on(l.EventType.FINISHED,this.onAnimationEnd,this)}play(t){if(null==t||null==t.node||this.mPlaying)return;this.node.active=!0,this.mPlaying=!0;let n=this.node.getPosition(),i=t.node.getPosition();0===t.line?n.y=i.y-t.getHeight():n.y=i.y,this.node.setPosition(n),this.mText.string=m.clamp(t.getData().content);let e=this.mText.fontSize*this.mText.string.length,o=this.mBackground.getComponent(c).contentSize.clone();o.width=e>260?e+30:260,this.mBackground.getComponent(c).setContentSize(o),this.boomAnim.getComponent(l).play()}hide(){this.node.active=!1,this.mPlaying=!1}onAnimationEnd(){this.boomAnim.getComponent(l).stop(),this.scheduleOnce((()=>{this.hide()}),.3)}})._instance=null,b=n((y=B).prototype,"boomAnim",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=n(y.prototype,"mText",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(y.prototype,"mBackground",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=y))||d));e._RF.pop()}}}));

System.register("chunks:///_virtual/ColorUtils.ts",["cc"],(function(t){var o,r;return{setters:[function(t){o=t.cclegacy,r=t.Color}],execute:function(){o._RF.push({},"0a1be+PlqVKOarY0ro2w1k+","ColorUtils",void 0);t("ColorUtils",class{static fixedColor(t,o=""){return o&&""!==o?new r(o):t}}),o._RF.pop()}}}));

System.register("chunks:///_virtual/DanmakuConfig.ts",["cc"],(function(i){var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"af770B8zC1CD6Dn4v686RRo","DanmakuConfig",void 0);i("DanmakuConfig",class{constructor(){this.type=1,this.playSpeed=100,this.lineCount=4,this.lineHeight=52,this.lineMargin=20,this.itemMargin=40,this.alpha=255,this.moveTime=4e3,this.fontSize=40}setFontSize(i){switch(i){case 0:this.fontSize=32,this.lineHeight=40;break;case 1:this.fontSize=36,this.lineHeight=44;break;case 2:this.fontSize=40,this.lineHeight=52;break;case 3:this.fontSize=44,this.lineHeight=56;break;case 4:this.fontSize=46,this.lineHeight=64}}}),t._RF.pop()}}}));

System.register("chunks:///_virtual/DanmakuController.ts",["cc","./DataManager.ts","./DanmakuConfig.ts","./DanmakuLoader.ts","./DanmakuData.ts","./LogUtils.ts","./NativeBridgeUtils.ts","./MessageConstants.ts","./PKAnimationController.ts","./MessageCenter.ts"],(function(t){var e,a,n,i,s,o,r,l,m,h,g,c,p,d;return{setters:[function(t){e=t.cclegacy,a=t._decorator,n=t.Component,i=t.game},function(t){s=t.DataManager},function(t){o=t.DanmakuConfig},function(t){r=t.DanmakuLoader},function(t){l=t.danmaDirection},function(t){m=t.LogUtils},function(t){h=t.NativeBridgeUtils},function(t){g=t.ActionType,c=t.MessageType},function(t){p=t.PKAnimationController},function(t){d=t.MessageCenter}],execute:function(){var u,C;e._RF.push({},"fdbfcB5QAtGepFZ5SiGFqnD","DanmakuController",void 0);const{ccclass:D,property:y}=a;t("DanmakuController",D("DanmakuController")(((C=class t extends n{constructor(...t){super(...t),this.mIsPlaying=!1,this.preHeatAnimationPlaying=!0,this.mDataManager=void 0,this.config=new o,this.mRenderEngine=void 0,this.mAnimController=void 0,this.roleCampList=void 0,this.syncFoldDeviceMessage=t=>{m.d("syncFoldDeviceMessage: ",t);let e=JSON.parse(t);if(e&&e.cameraState){if(this.mAnimController||(this.mAnimController=this.node.getComponent(p)),this.mAnimController.setCameraState(e.cameraState),"fold_multi_camera"===t.cameraState){let t=this.mAnimController.getProgressViewHeight(),e=this.config.lineHeight,a=this.config.lineMargin,n=this.config.lineCount,s=i.canvas.height;(e+a)*n+t>=s||((e+a)*(n-1)+t>=s?this.config.lineCount=n-1:(e+a)*(n-2)+t>=s&&(this.config.lineCount=n-2))}}else m.d("syncFoldDeviceMessage: ",e)}}static getInstance(){return t._instance}onLoad(){t._instance=this,d.getInstance().on(g.SET_FOLD_DEVICE,this.syncFoldDeviceMessage)}onDestroy(){d.getInstance().off(g.SET_FOLD_DEVICE,this.syncFoldDeviceMessage)}start(){this.mDataManager=new s(this.config),this.mRenderEngine=this.node.getComponent(r),this.mAnimController=this.node.getComponent(p),h.sendToNative(c.MSG_COCOS_READY,"")}updateOpacity(t){t<0&&(t=0),t>255&&(t=255),this.mRenderEngine?.updateOpacity(t),this.mAnimController?.updateOpacity(t)}updateTime(t){t>0&&this.mDataManager.onPlay(t)}setJsonData(t,e=0){let a=JSON.parse(t);this.setData(a,e)}setData(t,e=0){this.mDataManager.setData(t),e>0&&this.mDataManager.onPlay(e)}onLayoutSizeChanged(t,e){this.mRenderEngine.onLayoutSizeChanged(t,e)}appendJsonData(t){let e=JSON.parse(t);this.appendData(e)}appendData(t){this.mDataManager.appendData(t)}addFakeData(t){this.mDataManager.addFakeData(t),/*!this.mIsPause*/this.mIsPlaying&&this.innerStart()}startPlay(t=0){this.mIsPlaying||this.scheduleOnce((()=>{this.innerStart(t)}))}innerStart(t=0){this.mIsPlaying||(this.mIsPlaying=!0,this.mDataManager.onPlay(t))}pause(){this.mIsPlaying=!1,this.mDataManager.onPause(),this.mAnimController.pauseAnimation()}resume(){this.mIsPlaying=!0,this.mDataManager.onPlay(0),this.mAnimController.resumeAnimation()}update(t){let e=this.mDataManager.queryPlayTime();if(this.mIsPlaying&&!this.preHeatAnimationPlaying){let a=this.mDataManager.queryDanmaku();this.mRenderEngine.addItems(e,a),this.mRenderEngine.typesetting(e,!0,t)}}clear(){this.mRenderEngine.clear()}stop(t){this.mIsPlaying=!1,this.mDataManager.onStop(),this.clear(),t||this.mAnimController.stopAnimation()}setRoleCampJsonData(t){let e=JSON.parse(t);this.setRoleCampList(e)}setRoleCampList(t){this.roleCampList=t,this.mAnimController.setCampList(t)}getRoleCampList(){return this.roleCampList}getRoleCampData(t){if(!this.roleCampList||this.roleCampList.length<2)return m.d("getRoleCompData:","roleCampList is null"),null;var e=null;return this.roleCampList[0].pk_role_dt===t||2===this.roleCampList[0].pk_role_dt&&t===l.R_TO_L?e=this.roleCampList[0]:(this.roleCampList[1].pk_role_dt===t||2===this.roleCampList[1].pk_role_dt&&t===l.R_TO_L)&&(e=this.roleCampList[1]),m.d("getRoleCompData:",JSON.stringify(e)+", direction: "+t),e}updatePreHeatAnimationState(t){this.preHeatAnimationPlaying=t}})._instance=null,u=C))||u);e._RF.pop()}}}));

System.register("chunks:///_virtual/DanmakuData.ts",["cc"],(function(t){var i,_;return{setters:[function(t){i=t.cclegacy,_=t.Color}],execute:function(){i._RF.push({},"22adaCw7aBNnbwXcKHuko3P","DanmakuData",void 0);const e=t("LAYER_TYPE_UNDEFINE",1e3),s=(t("LAYER_TYPE_SCROLL",1001),t("LAYER_TYPE_TOP_CENTER",1002),t("LAYER_TYPE_BOTTOM_CENTER",1003),t("DRAW_TYPE_UNDEFINE",1e3)),T=(t("DRAW_TYPE_TEXT",1001),t("EFFECT_TYPE_TEXT",0),t("EFFECT_TYPE_WAVE",1));let a=t("danmaDirection",function(t){return t[t.R_TO_L=-1]="R_TO_L",t[t.L_TO_R=1]="L_TO_R",t}({}));t("DanmakuData",class{constructor(){this.id=void 0,this.type=void 0,this.content=void 0,this.showAtTime=void 0,this.layerType=e,this.v2_up_count=-1,this.self_praise=!1,this.up_out=0,this.avatar="",this.direction=a.R_TO_L,this.uname="",this.drawType=s,this.textColor=_.WHITE,this.font_color="",this.isSelfSent=!1,this.textSize=24,this.effectType=T,this.pk_id=-1,this.pk_role_id=-1}}),i._RF.pop()}}}));

System.register("chunks:///_virtual/DanmakuFeedbackDialogController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MessageConstants.ts","./NativeBridgeUtils.ts","./LogUtils.ts","./StringUtils.ts","./PraiseAnimation.ts","./BoomAnimation.ts"],(function(t){var e,i,n,o,s,a,r,h,l,u,d,p,c,g,m,b,S,f,N,_;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){n=t.cclegacy,o=t.Label,s=t.Node,a=t._decorator,r=t.Component,h=t.Animation,l=t.UITransform,u=t.native,d=t.Sprite,p=t.resources,c=t.SpriteAtlas,g=t.SpriteFrame},function(t){m=t.MessageType},function(t){b=t.NativeBridgeUtils},function(t){S=t.LogUtils},function(t){f=t.StringUtils},function(t){N=t.PraiseAnimation},function(t){_=t.BoomAnimation}],execute:function(){var y,w,C,v,I,P,D,H,T,z,L,k,B,F,M,O;n._RF.push({},"b4a3euhbk5DqqrnnfASX77r","DanmakuFeedbackDialogController",void 0);const{ccclass:U,property:A}=a;t("DanmakuFeedbackDialogController",(y=U("DanmakuFeedbackDialogController"),w=A(o),C=A(s),v=A(s),I=A(s),P=A(s),D=A(s),y(((O=class t extends r{constructor(...t){super(...t),this.animation=null,i(this,"content",z,this),i(this,"layoutNode",L,this),i(this,"bgNode",k,this),i(this,"praiseNode",B,this),i(this,"bombNode",F,this),i(this,"reportNode",M,this),this.initWidth=0,this.initHeight=0,this.initYPos=0,this.mShowingItem=null,this.mShowing=!1,this.autoHide=()=>{this.animation.play("hide"),this.node.active=!1,this.mShowing=!1,this.unschedule(this.autoHide),N.getInstance()&&N.getInstance().stop()}}static getInstance(){return t._instance}onLoad(){t._instance=this,this.animation=this.node.getComponent(h)}start(){this.node.active=!1;let t=this.node.getComponent(l);this.initWidth=t.width,this.initHeight=t.height,this.initYPos=this.node.getPosition().y,this.layoutNode.on("size-changed",this.onChildSizeChanged,this),this.praiseNode.on(s.EventType.TOUCH_END,this.onPraise,this),this.bombNode.on(s.EventType.TOUCH_END,this.onBomb,this),this.reportNode.on(s.EventType.TOUCH_END,this.onReport,this)}onPraise(t){if(t.propagationStopped=!0,!this.mShowingItem)return;let e=this.mShowingItem.getData();if(!e||e.self_praise)return;e.v2_up_count=e.v2_up_count>0?e.v2_up_count+1:1,e.self_praise=!0,this.updatePraiseLabel(e),this.mShowingItem.reload(),N.getInstance().play(this.mShowingItem),this.scheduleOnce((()=>{this.autoHide()}),1);let i=JSON.stringify(e);b.sendToNative(m.MSG_PRAISE,i),b.sendToNative(m.MSG_CLICK,"")}onBomb(t){t.propagationStopped=!0,b.sendToNative(m.MSG_BOMB,""),_.getInstance().play(this.mShowingItem),this.autoHide(),this.scheduleOnce((()=>{null!=this.mShowingItem&&(this.mShowingItem.toRemove=!0,this.mShowingItem=null)}),.5),b.sendToNative(m.MSG_CLICK,"")}onReport(t){if(t.propagationStopped=!0,u.bridge&&this.mShowingItem){let t=JSON.stringify(this.mShowingItem.getData());u.bridge.sendToNative(m.MSG_REPORT,t)}b.sendToNative(m.MSG_CLICK,"")}onChildSizeChanged(){let t=this.layoutNode.getComponent(l).contentSize.width,e=this.bgNode.getComponent(l),i=e.contentSize.clone();i.width=t+20,e.contentSize=i}show(t){if(null==t)return;if(this.mShowing)return void this.autoHide();this.mShowing=!0,this.mShowingItem=t,this.node.active=!0;let e=this.node.getPosition();0===t.line?e.y=t.node.position.y-t.getHeight():e.y=t.node.position.y,this.node.setPosition(e),this.unschedule(this.autoHide),this.scheduleOnce(this.autoHide,5);let i=t.getData();this.content.string=f.clamp(i.content),this.updatePraiseLabel(i),this.updatePraiseIcon(i),this.animation.play("show")}isShowing(){return this.mShowing}hide(){this.autoHide()}updatePraiseLabel(t){let e=this.praiseNode.getChildByName("Label").getComponent(o);t.v2_up_count>0?e.string=""+t.v2_up_count:e.string="点赞"}updatePraiseIcon(t){let e=this.praiseNode.getChildByName("Sprite").getComponent(d);t.self_praise?p.load("/frames/praise/praise",c,((t,i)=>{t?S.d("[Praise]","load image fail: "+t):e.spriteFrame=i.getSpriteFrame("praise_00040")})):p.load("/icons/icon_player_barrage_danmaku_praise/spriteFrame",g,((t,i)=>{t?S.d("[Praise]","load image fail: "+t):e.spriteFrame=i}))}})._instance=null,z=e((T=O).prototype,"content",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(T.prototype,"layoutNode",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(T.prototype,"bgNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(T.prototype,"praiseNode",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(T.prototype,"bombNode",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(T.prototype,"reportNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=T))||H));n._RF.pop()}}}));

System.register("chunks:///_virtual/DanmakuLoader.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DanmakuData.ts","./DrawItem.ts","./BaseRenderLayer.ts","./DanmakuController.ts","./DanmakuUtils.ts","./DanmaNodePool.ts","./LogUtils.ts"],(function(e){var t,a,n,r,o,i,s,l,p,d,u,h,m,c,y,L,f,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.initializerDefineProperty},function(e){n=e.cclegacy,r=e.Prefab,o=e._decorator,i=e.Component,s=e.Node,l=e.instantiate,p=e.UITransform},function(e){d=e.LAYER_TYPE_TOP_CENTER,u=e.LAYER_TYPE_BOTTOM_CENTER,h=e.LAYER_TYPE_SCROLL},function(e){m=e.DrawItem},function(e){c=e.BaseRenderLayer},function(e){y=e.DanmakuController},function(e){L=e.DanmakuUtils},function(e){f=e.DanmaNodePool},function(e){g=e.LogUtils}],execute:function(){var D,C,_,k,R;n._RF.push({},"3b295AHFYhAA5xklZLQLKJ+","DanmakuLoader",void 0);const{ccclass:T,property:E}=o;e("DanmakuLoader",(D=T("DanmakuLoader"),C=E({type:[r]}),D((R=t((k=class extends i{constructor(...e){super(...e),a(this,"prefabs",R,this),this.mRenderLayers=void 0,this.mNodePoolList=[],this.onDrawingDanmakuCount=0,this.mController=void 0}onLoad(){this.prefabs.forEach(((e,t)=>{let a=new f("DrawItem");0===t?a.setCapacity(18):a.setCapacity(5),this.mNodePoolList.push(a)}))}start(){this.mController=this.node.getComponent(y),this.mRenderLayers=this.getComponentsInChildren(c),this.mRenderLayers.forEach((e=>{e.init(this.mController,this.mNodePoolList)}))}onLayoutSizeChanged(e,t){this.mRenderLayers.forEach((a=>{a.onLayoutSizeChanged(e,t)}))}wrapData(e){let t=L.getPrefabIndex(e),a=this.mNodePoolList[t].get();null==a&&(a=this.createNodeByType(t));let n=a.getComponent(m);return n.bindData(e),n}createNodeByType(e){return e<0||e>=this.prefabs.length?new s:l(this.prefabs[e])}addItems(e,t){0!=t.length&&this.mRenderLayers.forEach((a=>{let n=new Array;t.forEach((e=>{if(2===this.mRenderLayers.length){if(!e||null==e.pk_id)return;if(L.compareVersion("8.1.7")>=0){var t=this.mController.getRoleCampList();if(!t||t[0].pk_id!=e.pk_id)return}let r=a.getRoleCampData(e.pk_id);r&&null!==e.pk_role_id?e.pk_role_id===r.pk_role_id&&(e.direction=a.getDirection(),e.font_color=r.pk_font_color,this.layerTypeIsMatch(e,a)&&n.push(this.wrapData(e))):r?null!==e.pk_role_id&&g.d("danmu item is not pk type",JSON.stringify(e)):g.d("roleCamp is null","")}else this.layerTypeIsMatch(e,a)&&n.push(this.wrapData(e))})),a.addItems(e,n)}))}layerTypeIsMatch(e,t){return e.layerType==t.getLayerType()||(e.layerType==d||e.layerType==u)&&t.getLayerType()==h}typesetting(e,t,a){return this.onDrawingDanmakuCount=0,this.mRenderLayers.forEach((n=>{this.onDrawingDanmakuCount+=n.typesetting(e,t,a)})),this.onDrawingDanmakuCount}clear(){this.mRenderLayers.forEach((e=>{e.clear()}))}updateOpacity(e){this.mRenderLayers.forEach((t=>{t?.updateOpacity(e)}))}setRealTimeVoteData(e,t,a){let n=this.mRenderLayers[0],r=this.mRenderLayers[1],o=n.getInitialWidth(),i=n.getInitialHeight(),s=2*o*e;n.node.getComponent(p).setContentSize(s,i),n.updateLayerContentSize(s,i);let l=2*o*(1-e);r.node.getComponent(p).setContentSize(l,i),r.updateLayerContentSize(l,i)}}).prototype,"prefabs",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_=k))||_));n._RF.pop()}}}));

System.register("chunks:///_virtual/DanmakuManager.ts",["cc"],(function(n){var a;return{setters:[function(n){a=n.cclegacy}],execute:function(){a._RF.push({},"7b0b5c6yExJ5KWZ9VBLH/eO","DanmakuManager",void 0);class t{static getInstance(){return null===t._instance&&null===t._instance&&(t._instance=new t),t._instance}constructor(){this.isPlaying=!1}}n("DanmakuManager",t),t._instance=null,a._RF.pop()}}}));

System.register("chunks:///_virtual/DanmakuParser.ts",["cc"],(function(a){var s;return{setters:[function(a){s=a.cclegacy}],execute:function(){s._RF.push({},"0cae1ksB2FG6J/KqlbDkmVV","DanmakuParser",void 0);a("DanmakuParser",class{constructor(){this.danmakuConfig=void 0,this.damakuDatas=void 0}}),s._RF.pop()}}}));

System.register("chunks:///_virtual/DanmakuUtils.ts",["cc","./LogUtils.ts"],(function(t){var e,r,i;return{setters:[function(t){e=t.cclegacy,r=t.sys},function(t){i=t.LogUtils}],execute:function(){e._RF.push({},"cf367YWeypPxrSNaly+/KG9","DanmakuUtils",void 0);t("DanmakuUtils",class{static getPrefabIndex(t){return t.isSelfSent?1:0}static isClientSupported(){return!(this.compareVersion("8.1.7")<0)||(i.d("root","client version lower than 8.1.7"),!1)}static getMGTVClientVersion(){var t;return"Android"==r.os?"8.2.3":("iOS"==r.os&&(t=jsb.reflection.callStaticMethod("MGNDeviceInfo","getBigVersion")),t)}static compareVersion(t){if("Android"!=r.os&&"iOS"!=r.os)return 1;var e=this.getMGTVClientVersion();if(!e)return-1;for(var i=e.split("."),n=t.split("."),s=0;s<i.length;s++){if(s>=n.length)return 1;var o=s==i.length-1?i[s].split("_")[0]:i[s],a=parseInt(o),l=parseInt(n[s]);if(a>l)return 1;if(a!==l)return-1}return i.length===n.length?0:-1}}),e._RF.pop()}}}));

System.register("chunks:///_virtual/DanmaNodePool.ts",["cc"],(function(t){var e,o;return{setters:[function(t){e=t.cclegacy,o=t.NodePool}],execute:function(){e._RF.push({},"5e8beLFUCNGxbck3UtpLwry","DanmaNodePool",void 0);t("DanmaNodePool",class extends o{constructor(...t){super(...t),this.nodeCount=0,this.capacity=10}add(t){this.nodeCount<this.capacity?(this.nodeCount++,super.put(t)):t.destroy()}setCapacity(t){this.capacity=t}put(t){}get(...t){return super.get(t)}clear(){this.nodeCount=0,super.clear()}size(){return super.size()}count(){return this.nodeCount}}),e._RF.pop()}}}));

System.register("chunks:///_virtual/DataManager.ts",["cc"],(function(t){var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"8e1a6QXHRZK9LiTzUgX9qSB","DataManager",void 0);t("DataManager",class{constructor(t){this.mIsPlaying=!1,this.mCurrentIndex=0,this.mStartPlayTime=0,this.mStartTimestamp=0,this.mCurrentPlayTime=0,this.mList=new Array,this.mQueryList=new Array,this.mFakeList=new Array,this.mConfig=void 0,this.mConfig=t}setData(t){this.clearArray(this.mList),this.mList=[...this.mList,...t]}appendData(t){this.mList=[...this.mList,...t]}getData(){return this.mList}onPlay(t){this.mIsPlaying=!0,this.mCurrentIndex=0,this.mStartPlayTime=Math.max(0,t),this.mStartTimestamp=Date.now(),this.mCurrentPlayTime=this.mStartPlayTime,this.mCurrentIndex=this.mList.length}queryPlayTime(){if(!this.mIsPlaying)return this.mCurrentPlayTime;let t=(Date.now()-this.mStartTimestamp)*this.mConfig.playSpeed/100+this.mStartPlayTime;return this.mCurrentPlayTime=t,this.mCurrentPlayTime}queryDanmaku(){return this.mIsPlaying?(this.mQueryList.splice(0,this.mQueryList.length),this.mQueryList=[...this.mQueryList,...this.mFakeList],this.mFakeList.splice(0,this.mFakeList.length),this.mQueryList=[...this.mQueryList,...this.mList],this.mList.splice(0,this.mList.length),this.mQueryList):this.mQueryList.splice(0,this.mQueryList.length)}getRemainDanmakuCount(){return this.mList.length-this.mCurrentIndex}onPause(){this.mIsPlaying=!1}onStop(){this.mIsPlaying=!1,this.mList.splice(0,this.mList.length),this.clearArray(this.mQueryList),this.clearArray(this.mFakeList),this.mCurrentIndex=0,this.mStartPlayTime=0,this.mStartTimestamp=0,this.mCurrentPlayTime=0}clearArray(t){null!=t&&t.length>0&&t.splice(0,t.length)}addFakeData(t){this.mFakeList.push(t)}}),i._RF.pop()}}}));

System.register("chunks:///_virtual/debug-view-runtime-control.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,n,s,l,r,h,g,a,c,p,C,d,m;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.initializerDefineProperty},function(t){i=t.cclegacy,n=t.Node,s=t._decorator,l=t.Component,r=t.Color,h=t.Canvas,g=t.UITransform,a=t.instantiate,c=t.Label,p=t.RichText,C=t.Toggle,d=t.Button,m=t.director}],execute:function(){var u,L,M,b,T,f,x,S,E;i._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);const{ccclass:v,property:I}=s;t("DebugViewRuntimeControl",(u=v("internal.DebugViewRuntimeControl"),L=I(n),M=I(n),b=I(n),u((x=e((f=class extends l{constructor(...t){super(...t),o(this,"compositeModeToggle",x,this),o(this,"singleModeToggle",S,this),o(this,"EnableAllCompositeModeButton",E,this),this._single=0,this.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],this.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],this.strMisc=["CSM Layer Coloration","Lighting With Albedo"],this.compositeModeToggleList=[],this.singleModeToggleList=[],this.miscModeToggleList=[],this.textComponentList=[],this.labelComponentList=[],this.textContentList=[],this.hideButtonLabel=void 0,this._currentColorIndex=0,this.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],this.color=[r.WHITE,r.BLACK,r.RED,r.GREEN,r.BLUE]}start(){if(!this.node.parent.getComponent(h))return void console.error("debug-view-runtime-control should be child of Canvas");const t=this.node.parent.getComponent(g),e=.5*t.width,o=.5*t.height;let i=.1*e-e,n=o-.1*o;const s=this.node.getChildByName("MiscMode"),l=a(s);l.parent=this.node,l.name="Buttons";const m=a(s);m.parent=this.node,m.name="Titles";for(let t=0;t<2;t++){const e=a(this.EnableAllCompositeModeButton.getChildByName("Label"));e.setPosition(i+(t>0?450:150),n,0),e.setScale(.75,.75,.75),e.parent=m;const o=e.getComponent(c);o.string=t?"----------Composite Mode----------":"----------Single Mode----------",o.color=r.WHITE,o.overflow=0,this.labelComponentList[this.labelComponentList.length]=o}n-=20;let u=0;for(let t=0;t<this.strSingle.length;t++,u++){t===this.strSingle.length>>1&&(i+=200,u=0);const e=t?a(this.singleModeToggle):this.singleModeToggle;e.setPosition(i,n-20*u,0),e.setScale(.5,.5,.5),e.parent=this.singleModeToggle.parent;const o=e.getComponentInChildren(p);o.string=this.strSingle[t],this.textComponentList[this.textComponentList.length]=o,this.textContentList[this.textContentList.length]=o.string,e.on(C.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[t]=e}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,n,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(d.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=l;let L=this.EnableAllCompositeModeButton.getComponentInChildren(c);this.labelComponentList[this.labelComponentList.length]=L;const M=a(this.EnableAllCompositeModeButton);M.setPosition(i+90,n,0),M.setScale(.5,.5,.5),M.on(d.EventType.CLICK,this.changeTextColor,this),M.parent=l,L=M.getComponentInChildren(c),L.string="TextColor",this.labelComponentList[this.labelComponentList.length]=L;const b=a(this.EnableAllCompositeModeButton);b.setPosition(i+200,n,0),b.setScale(.5,.5,.5),b.on(d.EventType.CLICK,this.hideUI,this),b.parent=this.node.parent,L=b.getComponentInChildren(c),L.string="Hide UI",this.labelComponentList[this.labelComponentList.length]=L,this.hideButtonLabel=L,n-=40;for(let t=0;t<this.strMisc.length;t++){const e=a(this.compositeModeToggle);e.setPosition(i,n-20*t,0),e.setScale(.5,.5,.5),e.parent=s;const o=e.getComponentInChildren(p);o.string=this.strMisc[t],this.textComponentList[this.textComponentList.length]=o,this.textContentList[this.textContentList.length]=o.string;e.getComponent(C).isChecked=!!t,e.on(C.EventType.TOGGLE,t?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[t]=e}n-=150;for(let t=0;t<this.strComposite.length;t++){const e=t?a(this.compositeModeToggle):this.compositeModeToggle;e.setPosition(i,n-20*t,0),e.setScale(.5,.5,.5),e.parent=this.compositeModeToggle.parent;const o=e.getComponentInChildren(p);o.string=this.strComposite[t],this.textComponentList[this.textComponentList.length]=o,this.textContentList[this.textContentList.length]=o.string,e.on(C.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[t]=e}}isTextMatched(t,e){let o=new String(t);const i=o.search(">");return-1===i?t===e:(o=o.substr(i+1),o=o.substr(0,o.search("<")),o===e)}toggleSingleMode(t){const e=m.root.debugView,o=t.getComponentInChildren(p);for(let t=0;t<this.strSingle.length;t++)this.isTextMatched(o.string,this.strSingle[t])&&(e.singleMode=t)}toggleCompositeMode(t){const e=m.root.debugView,o=t.getComponentInChildren(p);for(let i=0;i<this.strComposite.length;i++)this.isTextMatched(o.string,this.strComposite[i])&&e.enableCompositeMode(i,t.isChecked)}toggleLightingWithAlbedo(t){m.root.debugView.lightingWithAlbedo=t.isChecked}toggleCSMColoration(t){m.root.debugView.csmLayerColoration=t.isChecked}enableAllCompositeMode(t){const e=m.root.debugView;e.enableAllCompositeMode(!0);for(let t=0;t<this.compositeModeToggleList.length;t++){this.compositeModeToggleList[t].getComponent(C).isChecked=!0}let o=this.miscModeToggleList[0].getComponent(C);o.isChecked=!1,e.csmLayerColoration=!1,o=this.miscModeToggleList[1].getComponent(C),o.isChecked=!0,e.lightingWithAlbedo=!0}hideUI(t){const e=this.node.getChildByName("Titles"),o=!e.active;this.singleModeToggleList[0].parent.active=o,this.miscModeToggleList[0].parent.active=o,this.compositeModeToggleList[0].parent.active=o,this.EnableAllCompositeModeButton.parent.active=o,e.active=o,this.hideButtonLabel.string=o?"Hide UI":"Show UI"}changeTextColor(t){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(let t=0;t<this.textComponentList.length;t++)this.textComponentList[t].string=this.strColor[this._currentColorIndex]+this.textContentList[t]+"</color>";for(let t=0;t<this.labelComponentList.length;t++)this.labelComponentList[t].color=this.color[this._currentColorIndex]}onLoad(){}update(t){}}).prototype,"compositeModeToggle",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(f.prototype,"singleModeToggle",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(f.prototype,"EnableAllCompositeModeButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=f))||T));i._RF.pop()}}}));

System.register("chunks:///_virtual/DrawItem.ts",["cc","./LogUtils.ts","./DanmakuController.ts","./StringUtils.ts"],(function(t){var e,i,n,o,s,c,a;return{setters:[function(t){e=t.cclegacy,i=t.Component,n=t.NodeEventType,o=t.UITransform},function(t){s=t.LogUtils},function(t){c=t.DanmakuController},function(t){a=t.StringUtils}],execute:function(){e._RF.push({},"042abX0jzFKu5hjSGncDgWT","DrawItem",void 0);const h=t("SCALE_TEXT_FONT",.93);t("DrawItem",class extends i{constructor(...t){super(...t),this.data=null,this.uiTransform=void 0,this.isPaused=!1,this.showDuration=void 0,this.direction=-1,this.line=-1,this.toRemove=!1,this.mClickListener=null,this.touchNode=null}getData(){return this.data}getTouchNode(){return this.node}onLoad(){}setOpacity(t){}bindData(t){this.toRemove=!1,this.data=t,this.direction=t.direction,this.onBindData(t),this.mClickListener=t=>{this.onClick(t)},null==this.touchNode&&(this.touchNode=this.getTouchNode()),this.touchNode.on(n.TOUCH_END,this.mClickListener),this.setOpacity(c.getInstance().config.alpha)}onClick(t){t.propagationStopped=!0,s.d("DrawItem","--onclick--"+this.data.content)}onBindData(t){}onRelease(){this.touchNode.off(n.TOUCH_END,this.mClickListener)}onRecycle(){}recyclable(){return!0}getX(){return this.node.getPosition().x}setX(t){let e=this.node.getPosition();e.x=t,this.node.setPosition(e)}getWidth(){return a.clamp(this.getData().content).length*c.getInstance().config.fontSize*h}getTextWidth(){return a.clamp(this.getData().content).length*c.getInstance().config.fontSize*h}getHeight(){return this.node.getComponent(o).contentSize.height}startSpecialEffect(){}reload(){}}),e._RF.pop()}}}));

System.register("chunks:///_virtual/HeartAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,i,e,o,a,r,s,l;return{setters:[function(t){n=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){e=t.cclegacy,o=t.Sprite,a=t._decorator,r=t.Component,s=t.Animation,l=t.UITransform}],execute:function(){var c,u,m,p,h,y,d,g,f,b;e._RF.push({},"d5c77nriitAWpov8i4R+hZp","HeartAnimation",void 0);const{ccclass:v,property:P}=a;t("HeartAnimation",(c=v("HeartAnimation"),u=P(o),m=P(o),p=P(o),c(((b=class t extends r{constructor(...t){super(...t),i(this,"anim1",d,this),i(this,"anim2",g,this),i(this,"anim3",f,this),this.mPlaying=!1}static getInstance(){return t._instance}start(){this.node.active=!1,this.anim3.getComponent(s).on(s.EventType.FINISHED,this.onAnimationEnd,this)}onLoad(){t._instance=this}play(t){if(null==t||this.mPlaying)return;this.node.active=!0,this.mPlaying=!0;let n=this.node.getPosition(),i=t.getComponent(l),e=t.node.getPosition();n.y=e.y,n.x=e.x+i.contentSize.width-42,this.node.setPosition(n),this.anim1.getComponent(s).play(),this.scheduleOnce((()=>{this.anim2.getComponent(s).play()}),.3),this.scheduleOnce((()=>{this.anim3.getComponent(s).play()}),.6)}onAnimationEnd(){this.mPlaying=!1,this.node.active=!1}})._instance=null,d=n((y=b).prototype,"anim1",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=n(y.prototype,"anim2",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=n(y.prototype,"anim3",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=y))||h));e._RF.pop()}}}));

System.register("chunks:///_virtual/HtmlParser.ts",["cc"],(function(e){var s;return{setters:[function(e){s=e.cclegacy}],execute:function(){s._RF.push({},"2e021iqtGxCJ479Ig98rVuT","HtmlParser",void 0);const t=/^(click)(\s)*=|(param)(\s)*=/,r=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;e("HtmlTextParser",class{constructor(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"]),this._specialSymbolArray.push([/&nbsp;/g," "])}parse(e){this._resultObjectArray.length=0,this._stack.length=0;let s=0;const t=e.length;for(;s<t;){let r=e.indexOf(">",s),i=-1;if(r>=0){i=e.lastIndexOf("<",r);i<s-1&&(i=e.indexOf("<",r+1),r=e.indexOf(">",i+1))}if(i<0)this._stack.pop(),this._processResult(e.substring(s)),s=t;else{let t=e.substring(s,i);const n=e.substring(i+1,r);""===n&&(t=e.substring(s,r+1)),this._processResult(t),-1===r?r=i:"/"===e.charAt(i+1)?this._stack.pop():this._addToStack(n),s=r+1}}return this._resultObjectArray}_attributeToObject(e){e=e.trim();const s={};let t=/^(color|size)(\s)*=/.exec(e),i="",n=0,l="";if(t){if(i=t[0],""===(e=e.substring(i.length).trim()))return s;switch(n=e.indexOf(" "),i[0]){case"c":s.color=n>-1?e.substring(0,n).trim():e;break;case"s":s.size=parseInt(e)}return n>-1&&(l=e.substring(n+1).trim(),s.event=this._processEventHandler(l)),s}if(t=/^(br(\s)*\/)/.exec(e),t&&t[0].length>0&&(i=t[0].trim(),i.startsWith("br")&&"/"===i[i.length-1]))return s.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),s;t=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(e);let c="",a=-1;if(t&&t[0].length>0&&(i=t[0].trim(),i.startsWith("img")&&"/"===i[i.length-1])){let l;t=r.exec(e);let o=!1;for(;t;){i=(e=e.substring(e.indexOf(t[0]))).substr(0,t[0].length);const f=i.length;if(i=i.replace(/[^a-zA-Z]/g,"").trim(),i=i.toLowerCase(),c=e.substring(f).trim(),a="src"===i?this.getRightQuotationIndex(c):-1,n=c.indexOf(" ",a+1>=c.length?-1:a+1),l=n>-1?c.substr(0,n):c,e=c.substring(n).trim(),l.endsWith("/")&&(l=l.slice(0,-1)),"src"===i){switch(l.charCodeAt(0)){case 34:case 39:o=!0,l=l.slice(1,-1)}s.isImage=!0,s.src=l}else if("height"===i)s.imageHeight=parseInt(l);else if("width"===i)s.imageWidth=parseInt(l);else if("align"===i){switch(l.charCodeAt(0)){case 34:case 39:l=l.slice(1,-1)}s.imageAlign=l.toLowerCase()}else"offset"===i?s.imageOffset=l:"click"===i&&(s.event=this._processEventHandler(`${i}=${l}`));s.event&&"param"===i&&(s.event[i]=l.replace(/^"|"$/g,"")),t=r.exec(e)}return o&&s.isImage&&this._resultObjectArray.push({text:"",style:s}),{}}if(t=/^(cg(\s)*[^>]*)/.exec(e),t){let r={lb:"#ffffff",rb:"#ffffff",lt:"#ffffff",rt:"#ffffff"};if(e=t[0].substring("cg".length).trim()){let s,l,c=/(\s)*lb(\s)*=|(\s)*rb(\s)*=|(\s)*lt(\s)*=|(\s)*rt(\s)*=/;for(t=c.exec(e);t;)i=(e=e.substring(e.indexOf(t[0]))).substr(0,t[0].length),l=e.substring(i.length).trim(),n=l.indexOf(" "),s=n>-1?l.substr(0,n):l,i=i.replace(/[^a-zA-Z]/g,"").trim(),i=i.toLocaleLowerCase(),e=l.substring(n).trim(),"lb"===i?r.lb=s:"rb"===i?r.rb=s:"lt"===i?r.lt=s:"rt"===i&&(r.rt=s),t=c.exec(e)}s.colorGradient=r}if(t=/^(face(\s)*[^>]*)/.exec(e),t){let r={color:"#ffffff",dilate:.5,softness:.01};if(e=t[0].substring("face".length).trim()){let l,c,a=/(\s)*color(\s)*=|(\s)*dilate(\s)*=|(\s)*softness(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(t=a.exec(e);t;)i=(e=e.substring(e.indexOf(t[0]))).substr(0,t[0].length),c=e.substring(i.length).trim(),n=c.indexOf(" "),l=n>-1?c.substr(0,n):c,i=i.replace(/[^a-zA-Z]/g,"").trim(),i=i.toLocaleLowerCase(),e=c.substring(n).trim(),"click"===i?s.event=this._processEventHandler(`${i}=${l}`):"color"===i?r.color=l:"dilate"===i?r.dilate=Number(l):"softness"===i&&(r.softness=Number(l)),s.event&&"param"===i&&(s.event.param=l.replace(/^\"|\"$/g,"")),t=a.exec(e)}s.face=r}if(t=/^(outline(\s)*[^>]*)/.exec(e),t){const r={color:"#ffffff",thickness:.1};if(e=t[0].substring("outline".length).trim()){const l=/(\s)*color(\s)*=|(\s)*thickness(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;let a;for(t=l.exec(e);t;)i=(e=e.substring(e.indexOf(t[0]))).substr(0,t[0].length),c=e.substring(i.length).trim(),n=c.indexOf(" "),a=n>-1?c.substr(0,n):c,i=i.replace(/[^a-zA-Z]/g,"").trim(),i=i.toLowerCase(),e=c.substring(n).trim(),"click"===i?s.event=this._processEventHandler(`${i}=${a}`):"color"===i?r.color=a:"thickness"===i&&(r.thickness=Number(a)),s.event&&"param"===i&&(s.event[i]=a.replace(/^"|"$/g,"")),t=l.exec(e)}s.outline=r}if(t=/^(underlay(\s)*[^>]*)/.exec(e),t){let r={color:"#ffffff",x:0,y:0,dilate:.5,softness:.1};if(e=t[0].substring("underlay".length).trim()){let l,c,a=/(\s)*color(\s)*=|(\s)*x(\s)*=|(\s)*y(\s)*=|(\s)*dilate(\s)*=|(\s)*softness(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(t=a.exec(e);t;)i=(e=e.substring(e.indexOf(t[0]))).substr(0,t[0].length),c=e.substring(i.length).trim(),n=c.indexOf(" "),l=n>-1?c.substr(0,n):c,i=i.replace(/[^a-zA-Z]/g,"").trim(),i=i.toLocaleLowerCase(),e=c.substring(n).trim(),"click"===i?s.event=this._processEventHandler(`${i}=${l}`):"color"===i?r.color=l:"dilate"===i?r.dilate=Number(l):"softness"===i?r.softness=Number(l):"x"===i?r.x=Number(l):"y"===i&&(r.y=Number(l)),s.event&&"param"===i&&(s.event.param=l.replace(/^\"|\"$/g,"")),t=a.exec(e)}s.underlay=r}if(t=/^(glow(\s)*[^>]*)/.exec(e),t){let r={color:"#000000",offset:.5,inner:.01,outer:.01,power:1};if(e=t[0].substring("glow".length).trim()){let l,c,a=/(\s)*color(\s)*=|(\s)*offset(\s)*=|(\s)*inner(\s)*=|(\s)*outer(\s)*=|(\s)*power(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(t=a.exec(e);t;)i=(e=e.substring(e.indexOf(t[0]))).substr(0,t[0].length),c=e.substring(i.length).trim(),n=c.indexOf(" "),l=n>-1?c.substr(0,n):c,i=i.replace(/[^a-zA-Z]/g,"").trim(),i=i.toLocaleLowerCase(),e=c.substring(n).trim(),"click"===i?s.event=this._processEventHandler(`${i}=${l}`):"color"===i?r.color=l:"offset"===i?r.offset=Number(l):"inner"===i?r.inner=Number(l):"outer"===i?r.outer=Number(l):"power"===i&&(r.power=Number(l)),s.event&&"param"===i&&(s.event.param=l.replace(/^\"|\"$/g,"")),t=a.exec(e)}s.glow=r}if(t=/^(on|u|s|b|i)(\s)*/.exec(e),t&&t[0].length>0){switch(i=t[0],e=e.substring(i.length).trim(),i[0]){case"u":s.underline=!0,s.offset="="===e[0]?Number(e.slice(1)):0;break;case"s":s.strikethrough=!0,s.offset="="===e[0]?Number(e.slice(1)):0;break;case"i":s.italic=!0;break;case"b":s.bold=!0}if(""===e)return s;s.event=this._processEventHandler(e)}return s}getRightQuotationIndex(e){let s=-1,t=-1;const r=e.indexOf("'"),i=e.indexOf('"'),n=i>-1&&(i<r||-1===r);return r>-1&&(r<i||-1===i)?(s=r,t=e.indexOf("'",s+1>=e.length?-1:s+1)):n&&(s=i,t=e.indexOf('"',s+1>=e.length?-1:s+1)),t}_processEventHandler(e){const s={};let r=0,i=!1,n=t.exec(e);for(;n;){let l=n[0],c="";if(i=!1,'"'===(e=e.substring(l.length).trim()).charAt(0))r=e.indexOf('"',1),r>-1&&(c=e.substring(1,r).trim(),i=!0),r++;else if("'"===e.charAt(0))r=e.indexOf("'",1),r>-1&&(c=e.substring(1,r).trim(),i=!0),r++;else{const s=/(\S)+/.exec(e);c=s?s[0]:"",r=c.length}i&&(l=l.substring(0,l.length-1).trim(),s[l]=c),e=e.substring(r).trim(),n=t.exec(e)}return s}_addToStack(e){const s=this._attributeToObject(e);if(0===this._stack.length)this._stack.push(s);else{if(s.isNewLine||s.isImage)return;const e=this._stack[this._stack.length-1];for(const t in e)s[t]||(s[t]=e[t]);this._stack.push(s)}}_processResult(e){0!==e.length&&(e=this._escapeSpecialSymbol(e),this._stack.length>0?this._resultObjectArray.push({text:e,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:e}))}_escapeSpecialSymbol(e){for(const s of this._specialSymbolArray){const t=s[0],r=s[1];e=e.replace(t,r)}return e}}),s._RF.pop()}}}));

System.register("chunks:///_virtual/IRenderLayer.ts",["cc"],(function(){var e;return{setters:[function(c){e=c.cclegacy}],execute:function(){e._RF.push({},"3ffc2K98PxB3pTV5EOYlTCh","IRenderLayer",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/KvStorage.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"b6be4oakHlN5LIxDkS69XH8","KvStorage",void 0);class s{constructor(){this.storage=void 0,this.storage={}}static getInstance(){return s.instance||(s.instance=new s),s.instance}setItem(t,e){"object"==typeof e&&(e=JSON.stringify(e)),this.storage[t]=e}getItem(t){const e=this.storage[t];try{return JSON.parse(e)}catch{return e}}removeItem(t){delete this.storage[t]}clear(){this.storage={}}}t("KvStorage",s),s.KEY_PK_GUIDE_STATE="KEY_PK_GUIDE_STATE",s.KEY_PK_SELECTED_ROLE="KEY_PK_SELECTED_ROLE",s.instance=void 0,e._RF.pop()}}}));

System.register("chunks:///_virtual/LogUtils.ts",["cc","./MessageConstants.ts"],(function(s){var t,e,c;return{setters:[function(s){t=s.cclegacy,e=s.native},function(s){c=s.MessageType}],execute:function(){t._RF.push({},"35f42K/vglBppZWOVcqcJcl","LogUtils",void 0);s("LogUtils",class{static d(s,t){var o=s+" "+t;console.log(o),e.bridge?e.bridge.sendToNative(c.MSG_LOG,"[Cocos LogUtils] "+o):cc.log(s,t)}}),t._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./debug-view-runtime-control.ts","./SimpleTest.ts","./DanmaNodePool.ts","./DanmakuController.ts","./DanmakuLoader.ts","./PKAnimationController.ts","./PkProgressController.ts","./DanmakuConfig.ts","./DanmakuData.ts","./DanmakuParser.ts","./DataManager.ts","./NativeCampSelectData.ts","./PKVoteData.ts","./RoleCampData.ts","./DanmakuManager.ts","./DanmakuUtils.ts","./BoomAnimation.ts","./HeartAnimation.ts","./PraiseAnimation.ts","./DrawItem.ts","./OvalDrawItem.ts","./TextDrawItem.ts","./BaseRenderLayer.ts","./IRenderLayer.ts","./PkProgressBarLayer.ts","./RoleCampLayer.ts","./ScrollLayer.ts","./ScrollLine.ts","./MessageCenter.ts","./MessageConstants.ts","./NativeMessageHandler.ts","./DanmakuFeedbackDialogController.ts","./RoundRectMask.ts","./AutoFollowTargetPosition.ts","./ColorUtils.ts","./HtmlParser.ts","./KvStorage.ts","./LogUtils.ts","./NativeBridgeUtils.ts","./NumberUtils.ts","./ReourceUtils.ts","./RootController.ts","./StringUtils.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MessageCenter.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"7c7ddCO91xMioA2OJWjILHv","MessageCenter",void 0);class n{constructor(){this.eventHandlers={}}static getInstance(){return n.instance||(n.instance=new n),n.instance}on(e,t){this.eventHandlers[e]||(this.eventHandlers[e]=[]),this.eventHandlers[e].push(t)}off(e,t){const n=this.eventHandlers[e];n&&(this.eventHandlers[e]=n.filter((e=>e!==t)))}emit(e,...t){const n=this.eventHandlers[e];n&&n.forEach((e=>{e(...t)}))}}e("MessageCenter",n),n.instance=void 0,t._RF.pop()}}}));

System.register("chunks:///_virtual/MessageConstants.ts",["cc"],(function(_){var e;return{setters:[function(_){e=_.cclegacy}],execute:function(){e._RF.push({},"ec532kemDNCuaMEcLPI6L1P","MessageConstants",void 0);_("ActionType",function(_){return _.SET_DATA="action_set_data",_.APPEND_DATA="action_append_data",_.PAUSE="action_pause",_.RESUME="action_resume",_.START_PLAY="action_start_play",_.RELAYOUT="action_relayout",_.CLEAR="action_clear",_.UPDATE_TIME="action_update_time",_.ADD_LOCAL_DANMAKU="action_add_local_danmaku",_.CLOSE_DANMAKU_FEEDBACK_DIALOG="action_close_danmaku_feedback_dialog",_.SET_PK_CAMP_DATA="action_set_pk_camp_data",_.SET_FOLD_DEVICE="action_set_fold_device",_.ACTION_SET_PK_GUIDE_STATE="action_set_pk_guide_state",_.ACTION_SHOW_PK_GUIDE="action_show_pk_guide",_}({})),_("ConfigType",function(_){return _.SET_LINECOUNT="action_config_linecount",_.SET_LINEHEIGHT="action_config_lineheight",_.SET_LINEMARGIN="action_config_linemargin",_.SET_FONTSIZE="action_config_fontszie",_.SET_ITEMALPHA="action_config_itemalpha",_.SET_PLAYSPEED="action_config_playspeed",_.SET_MOVETIME="action_config_movetime",_}({})),_("MessageType",function(_){return _.MSG_COCOS_READY="msg_cocos_ready",_.MSG_TOGGLE_CONTROL="msg_toggle_control",_.MSG_CLICK="msg_click",_.MSG_LOG="msg_log",_.MSG_REPORT="msg_report",_.MSG_PRAISE="msg_praise",_.MSG_COPY="msg_copy",_.MSG_BOMB="msg_bomb",_.MSG_PRAISE_FROM_DIALOG="msg_praise_from_dialog",_.MSG_SELECT_ROLE="msg_select_role",_.MSG_CLOSE_CAMP_SELECT_PANEL="msg_close_camp_select_panel",_.MSG_COUNTDWON_FINISHED="msg_countdown_finished",_.MSG_ON_HEAD_CLICKED="msg_on_head_clicked",_}({}));class t{}_("MessageConstants",t),t.PK_START_MSG="PK_START_MSG",t.PK_FINISH_MSG="PK_FINISH_MSG",t.CLOSE_COCOS="CLOSE_COCOS",t.PK_SYNC_MSG="PK_SYNC_MSG",t.PK_ROLE_SELECTED_MSG="PK_ROLE_SELECTED_MSG",t.NATIVE_SELECT_CAMP="native_select_camp",e._RF.pop()}}}));

System.register("chunks:///_virtual/NativeBridgeUtils.ts",["cc"],(function(e){var t,i;return{setters:[function(e){t=e.cclegacy,i=e.native}],execute:function(){t._RF.push({},"95690rgL0hGurrjtRZ30Bn/","NativeBridgeUtils",void 0);e("NativeBridgeUtils",class{static sendToNative(e,t){i.bridge&&i.bridge.sendToNative(e,t)}}),t._RF.pop()}}}));

System.register("chunks:///_virtual/NativeCampSelectData.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"5ac2da/dC5LEaBLpCC+Kdr3","NativeCampSelectData",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/NativeMessageHandler.ts",["cc","./MessageConstants.ts","./DanmakuController.ts","./LogUtils.ts","./DanmakuFeedbackDialogController.ts","./MessageCenter.ts","./KvStorage.ts"],(function(e){var a,t,n,s,c,r,E,o;return{setters:[function(e){a=e.cclegacy},function(e){t=e.ActionType,n=e.ConfigType},function(e){s=e.DanmakuController},function(e){c=e.LogUtils},function(e){r=e.DanmakuFeedbackDialogController},function(e){E=e.MessageCenter},function(e){o=e.KvStorage}],execute:function(){a._RF.push({},"b8c38BF281FIr05+EmhebsE","NativeMessageHandler",void 0);e("NativeMessageHandler",class{handleNativeCmd(e,a,t){this.handleNativeCmdInternal(e,a,t)}handleNativeCmdInternal(e,a,I){switch(c.d(e,a),e){case t.PAUSE:s.getInstance().pause();break;case t.RESUME:s.getInstance().resume();break;case t.SET_DATA:s.getInstance().setJsonData(a);break;case t.APPEND_DATA:s.getInstance().appendJsonData(a);break;case t.START_PLAY:s.getInstance().startPlay(parseInt(a));break;case t.UPDATE_TIME:s.getInstance().updateTime(parseInt(a));break;case n.SET_FONTSIZE:case n.SET_LINECOUNT:case n.SET_LINEHEIGHT:break;case n.SET_ITEMALPHA:let c=parseInt(a);s.getInstance().config.alpha=c,s.getInstance().updateOpacity(c);break;case t.RELAYOUT:s.getInstance().clear(),s.getInstance().onLayoutSizeChanged(-1,-1);break;case t.CLEAR:s.getInstance().clear();break;case n.SET_MOVETIME:case n.SET_PLAYSPEED:break;case t.ADD_LOCAL_DANMAKU:let I=JSON.parse(a);s.getInstance().addFakeData(I);break;case t.CLOSE_DANMAKU_FEEDBACK_DIALOG:r.getInstance()&&r.getInstance().hide();break;case t.SET_PK_CAMP_DATA:s.getInstance().setRoleCampJsonData(a);break;case t.ACTION_SET_PK_GUIDE_STATE:o.getInstance().setItem(o.KEY_PK_GUIDE_STATE,a);break;default:E.getInstance().emit(e,a)}}}),a._RF.pop()}}}));

System.register("chunks:///_virtual/NumberUtils.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"6f140kallFLbIzJYneZcPQF","NumberUtils",void 0);t("NumberUtils",class{static getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}}),e._RF.pop()}}}));

System.register("chunks:///_virtual/OvalDrawItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StringUtils.ts","./DanmakuController.ts","./DrawItem.ts","./TextDrawItem.ts","./ColorUtils.ts"],(function(t){var e,n,o,i,r,a,c,l,s,u,h,g,p,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.initializerDefineProperty},function(t){o=t.cclegacy,i=t.Node,r=t.Label,a=t._decorator,c=t.Color,l=t.UITransform,s=t.Sprite},function(t){u=t.StringUtils},function(t){h=t.DanmakuController},function(t){g=t.SCALE_TEXT_FONT},function(t){p=t.TextDrawItem},function(t){f=t.ColorUtils}],execute:function(){var d,m,D,S,y,C,z;o._RF.push({},"c4a93SxVLNFHYi3sR7uWBqQ","OvalDrawItem",void 0);const{ccclass:I,property:w}=a;t("OvalDrawItem",(d=I("OvalDrawItem"),m=w(i),D=w(r),d((C=e((y=class extends p{constructor(...t){super(...t),n(this,"layoutNode",C,this),n(this,"content",z,this)}onBindData(t){this.content.color=f.fixedColor(c.WHITE,t.font_color),this.content.string=u.clamp(t.content),this.content.fontSize=h.getInstance().config.fontSize}onLayoutSizeChanged(){let t=this.content.getComponent(l),e=t.contentSize.width,n=t.contentSize.height,o=this.node.getComponent(l),i=n>o.height?n+10:o.height;o.setContentSize(e+40,i)}onLoad(){this.layoutNode.on("size-changed",this.onLayoutSizeChanged,this)}setOpacity(t){let e=this.node.getComponent(s),n=e.color.clone();n.a=t,e.color=n}getWidth(){return u.clamp(this.getData().content).length*h.getInstance().config.fontSize*g+40}}).prototype,"layoutNode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(y.prototype,"content",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=y))||S));o._RF.pop()}}}));

System.register("chunks:///_virtual/PKAnimationController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DanmakuUtils.ts","./LogUtils.ts","./RoleCampLayer.ts","./PkProgressController.ts","./MessageCenter.ts","./MessageConstants.ts","./DanmakuController.ts","./DanmakuData.ts","./DanmakuLoader.ts","./ReourceUtils.ts","./NativeBridgeUtils.ts","./KvStorage.ts"],(function(e){var t,i,o,n,s,a,r,l,h,d,m,p,c,g,u,P,C,y,f,k,S,_,A,v,E,L,w,I,D,N,T,V,R,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){o=e.cclegacy,n=e.Sprite,s=e.Node,a=e.Prefab,r=e.Graphics,l=e._decorator,h=e.Component,d=e.sys,m=e.VideoPlayer,p=e.UITransform,c=e.instantiate,g=e.game,u=e.Widget,P=e.resources,C=e.SpriteFrame,y=e.assetManager,f=e.Color,k=e.Animation},function(e){S=e.DanmakuUtils},function(e){_=e.LogUtils},function(e){A=e.RoleCampLayer},function(e){v=e.PkProgressController},function(e){E=e.MessageCenter},function(e){L=e.MessageConstants,w=e.ActionType,I=e.MessageType},function(e){D=e.DanmakuController},function(e){N=e.danmaDirection},function(e){T=e.DanmakuLoader},function(e){V=e.ResourceUtils},function(e){R=e.NativeBridgeUtils},function(e){b=e.KvStorage}],execute:function(){var O,F,M,K,z,B,x,G,H,U,W,Y,J,j,q,Q,Z;o._RF.push({},"5f6ebQli/VHCqZpzJfRhp4y","PKAnimationController",void 0);const{ccclass:X,property:$}=l;var ee=function(e){return e[e.unkown=0]="unkown",e[e.countdownAnimPlaying=1]="countdownAnimPlaying",e[e.countdownAnimFinished=2]="countdownAnimFinished",e[e.appearAnimPlaying=3]="appearAnimPlaying",e[e.appearAnimFinished=4]="appearAnimFinished",e[e.loopAnimPlaying=5]="loopAnimPlaying",e[e.loopAnimFinished=6]="loopAnimFinished",e[e.endAnimPlaying=7]="endAnimPlaying",e[e.endAnimFinished=8]="endAnimFinished",e}(ee||{});const te="PKAnimationController";e("PK_SELECT_LOCAL_STORAGE_KEY","PK_CAMP_STATUS");e("PKAnimationController",(O=X("PKAnimationController"),F=$(n),M=$(s),K=$({type:[a]}),z=$(s),B=$(n),x=$(r),G=$(r),O((W=t((U=class extends h{constructor(...e){super(...e),this.mIsPlaying=!1,this.mState=ee.unkown,this.mCampList=null,this.mPkProgressController=null,this.mRenderEngine=null,i(this,"videoplayer_bg",W,this),i(this,"videoNode",Y,this),this.videoPlayer=null,this.currentVideoClip=null,i(this,"prefabs",J,this),this.roleCampNode=null,this.roleDataLeft=null,this.roleDataRight=null,this.initialWidth=0,this.clientSupported=!0,this.mCameraState="normal",i(this,"animNode",j,this),i(this,"pkEnd",q,this),i(this,"pkEndMaskCtx",Q,this),i(this,"pkEndBorderCtx",Z,this),this.curVoteData=null,this.mIsPkFinished=!1,this.mPkLeftTime=0,this.handlePkRoleSelected=e=>{_.d(te,"---handlePkRoleSelected---"),this.hideCampLayer()},this.handleNativeCampSelected=e=>{if(_.d(te,"---handleNativeCampSelected---"),null!=e){let t=JSON.parse(e);if(t){b.getInstance().setItem(b.KEY_PK_SELECTED_ROLE,t.pk_role_id);for(let e=0;e<this.mCampList.length;e++)if(this.mCampList[e].pk_role_id==t.pk_role_id)return void E.getInstance().emit(L.PK_ROLE_SELECTED_MSG,t.pk_role_id)}}},this.setRealTimeVoteData=e=>{let t=JSON.parse(e);if(!t||!t.roles)return void _.d(te,"---setRealTimeVoteData, data: "+t);if(!this.roleDataLeft||!this.roleDataRight)return void _.d(te,"---setRealTimeVoteData: roleData is nil");if(this.mPkLeftTime=t.d,this.mState<ee.appearAnimFinished||!this.mIsPlaying)return void _.d(te,"---setRealTimeVoteData, state: "+this.mState+", isPlaying: "+this.mIsPlaying);this.curVoteData=t;let i=t.roles[0],o=t.roles[1],n=i.id===this.roleDataLeft.pk_role_id?i.c/(i.c+o.c):o.c/(i.c+o.c);n>.9&&(n=.9),n<.1&&(n=.1),this.updatePkProgress(t,n)},this.updatePkResult=e=>{if(_.d(te,"---updatePkResult, data: "+e),this.mIsPkFinished)return;this.mIsPkFinished=!0;let t=e?JSON.parse(e):this.curVoteData,i=0;if(t.roles[0].id===this.roleDataLeft.pk_role_id?t.roles[0].c>t.roles[1].c?i=-1:t.roles[0].c<t.roles[1].c&&(i=1):t.roles[0].c>t.roles[1].c?i=1:t.roles[0].c<t.roles[1].c&&(i=-1),0===i)return _.d(te,"pk finished with no body win and CLOSE_COCOS"),void R.sendToNative(L.CLOSE_COCOS,"");this.pkEndBorderCtx.node.active=!0,this.roleCampNode&&this.hideCampLayer(),D.getInstance().stop(!0),this.videoPlayer.stop(),this.mState=ee.loopAnimFinished,"Android"==d.os&&(this.videoPlayer.node.active=!1),this.playWinnerAvatarAnimation(i),this.getPkProgressController().updatePkResult(i),this.playEndAnimation()},this.showPkGuide=()=>{let e=b.getInstance().getItem(b.KEY_PK_SELECTED_ROLE);_.d(te,"---showPkGuide---"+e),e||this.checkIsSelected()&&(e=this.mCampList[0].camp_selected),this.getPkProgressController().showPkGuideAnimation(e)}}onLoad(){this.clientSupported=S.isClientSupported(),this.clientSupported?(this.mRenderEngine=this.node.getComponent(T),this.videoPlayer=this.videoNode.getComponent(m),"Android"!=d.os&&"iOS"!=d.os||(this.videoPlayer._impl.syncAlphaEnable(!0),this.videoPlayer._impl.syncAlphaLayoutPosition(3))):this.node.active=!1}start(){this.clientSupported&&(this.videoNode.on(m.EventType.META_LOADED,this.onMetaDataLoaded,this),this.videoNode.on(m.EventType.COMPLETED,this.onVideoPlayFinished,this),E.getInstance().on(L.PK_ROLE_SELECTED_MSG,this.handlePkRoleSelected),E.getInstance().on(L.NATIVE_SELECT_CAMP,this.handleNativeCampSelected),E.getInstance().on(L.PK_SYNC_MSG,this.setRealTimeVoteData),E.getInstance().on(L.PK_FINISH_MSG,this.updatePkResult),E.getInstance().on(w.ACTION_SHOW_PK_GUIDE,this.showPkGuide),this.initialWidth=this.node.getComponent(p).width,this.startAnimation())}onDestroy(){this.videoNode&&(this.videoNode.off(m.EventType.META_LOADED,this.onMetaDataLoaded,this),this.videoNode.off(m.EventType.COMPLETED,this.onVideoPlayFinished,this)),E.getInstance().off(L.PK_ROLE_SELECTED_MSG,this.handlePkRoleSelected),E.getInstance().off(L.NATIVE_SELECT_CAMP,this.handleNativeCampSelected),E.getInstance().off(L.PK_SYNC_MSG,this.setRealTimeVoteData),E.getInstance().off(L.PK_FINISH_MSG,this.updatePkResult),E.getInstance().off(w.ACTION_SHOW_PK_GUIDE,this.showPkGuide)}startAnimation(){this.mIsPlaying||(this.mIsPlaying=!0)}stopAnimation(){this.mIsPlaying&&(this.mIsPlaying=!1,this.videoPlayer.stop())}pauseAnimation(){_.d(te,"---pauseAnimation---"),this.mIsPlaying&&(this.mIsPlaying=!1,this.videoPlayer.pause())}resumeAnimation(){_.d(te,"---resumeAnimation---"),this.mIsPlaying||(this.mIsPlaying=!0,this.videoPlayer.resume())}playCountDownAnimation(){_.d(te,"---playCountDownAnimation---"),this.currentVideoClip&&(this.videoPlayer.clip=this.currentVideoClip,this.videoPlayer.loop=!1,V.loadVideoResource("/video/start",(e=>{this.currentVideoClip=e})))}showRoleCampView(){if("fold_multi_camera"===this.mCameraState)_.d(te,"---showRoleCampView for fold_multi_camera---"),R.sendToNative(I.MSG_COUNTDWON_FINISHED,"");else if(!this.roleCampNode){_.d(te,"---showRoleCampView---"),this.roleCampNode=c(this.prefabs[0]),this.roleCampNode.getComponent(A).onBindData(this.roleDataLeft,this.roleDataRight);let e=this.getProgressNodeSiblingIndex();this.node.insertChild(this.roleCampNode,e)}}playAppearAnimation(){if(_.d(te,"---playAppearAnimation---"),D.getInstance().updatePreHeatAnimationState(!1),this.currentVideoClip){let e=g.canvas.height-this.getProgressViewHeight();if("fold_multi_camera"===this.mCameraState&&e<420){let t=1920*e/420;this.videoNode.getComponent(p).setContentSize(t,e)}this.videoPlayer.clip=this.currentVideoClip,this.videoPlayer.loop=!1,V.loadVideoResource("/video/loop",(e=>{this.currentVideoClip=e}))}}playLoopAnimation(){_.d(te,"---playLoopAnimation---"),this.currentVideoClip&&(this.videoPlayer.clip=this.currentVideoClip,this.videoPlayer.loop=!0,V.loadVideoResource("/video/pkEnd",(e=>{this.currentVideoClip=e})))}playEndAnimation(){_.d(te,"---playEndAnimation---"),this.currentVideoClip&&("Android"===d.os?this.scheduleOnce((()=>{this.resetTransformForEndAnimation()}),.1):this.resetTransformForEndAnimation(),this.videoPlayer.stayOnBottom=!0,this.videoPlayer.clip=this.currentVideoClip,this.videoPlayer.loop=!1)}updateOpacity(e){this.getPkProgressController()?.updateOpacity(e),this.roleCampNode?.getComponent(A)?.updateOpacity(e)}setCampList(e){this.mCampList=e,!e||e.length<2?_.d(te,"camplist data error: "+e):(e[0].pk_role_dt===N.L_TO_R?(this.roleDataLeft=e[0],this.roleDataRight=e[1]):2===e[0].pk_role_dt&&(this.roleDataLeft=e[1],this.roleDataRight=e[0]),this.pkAnimationEntry())}setCameraState(e){_.d(te,"cameraState: "+e),this.mCameraState=e}pkAnimationEntry(){if(!this.mCampList||this.mCampList.length<2)return _.d(te,"camplist error"),void(this.node.active=!1);if(this.mPkLeftTime=this.mCampList[0].duration,_.d(te,"leftTime: "+this.mPkLeftTime),this.mPkLeftTime>=10&&this.checkIsNeedShowCountdownAnimation()){this.videoPlayer.node.getComponent(u).top=0,this.videoplayer_bg.node.active=!0,V.loadVideoResource("/video/countdown",(e=>{this.currentVideoClip=e,this.playCountDownAnimation()}))}else{this.videoPlayer.node.getComponent(u).top=this.getVideoPlayerTop(),this.videoplayer_bg.node.active=!1,this.mPkLeftTime<10?(_.d(te,"leftTime less than 10"),this.mState=ee.appearAnimFinished,V.loadVideoResource("/video/loop",(e=>{this.currentVideoClip=e,this.playLoopAnimation()}))):(this.mState=ee.countdownAnimFinished,V.loadVideoResource("/video/start",(e=>{this.currentVideoClip=e,this.checkIsSelected()||this.showRoleCampView(),this.playAppearAnimation()}))),this.showPkProgressBar()}}hideCampLayer(){_.d(te,"---hideCampLayer---"),this.roleCampNode&&(this.roleCampNode.destroy(),this.roleCampNode=null)}resetTransformForEndAnimation(){let e=this.videoNode.getComponent(u);e.isAlignTop=!1,e.isAlignBottom=!0,e.bottom=0;let t=this.videoNode.getComponent(p);t.setAnchorPoint(.5,.5);let i=1152e3/1400;if("fold_multi_camera"===this.mCameraState){let e=g.canvas.height-this.getProgressViewHeight(),o=1920*e/i;t.setContentSize(o,e)}else if("fold_single_camera"===this.mCameraState){let e=g.canvas.height,o=this.animNode.getComponent(p).contentSize.height,n=this.videoNode.getComponent(u),s=e/2-110-o-380;n.bottom=s,t.setContentSize(1920,i);let a="/textures/pk/fold_single_camera_bg@2x/spriteFrame";P.load(a,C,((e,t)=>{if(!e){this.videoplayer_bg.spriteFrame=t;let e=s;this.videoplayer_bg.getComponent(p).setContentSize(1920,e+1),this.videoplayer_bg.node.active=!0;let i=this.videoplayer_bg.node.getComponent(u);i.isAlignTop=!1,i.isAlignBottom=!0,i.bottom=0}}))}else t.setContentSize(1920,i)}onMetaDataLoaded(e){if(_.d(te,"---onMetaDataLoaded, state: "+this.mState),this.mIsPlaying)switch(this.videoPlayer.play(),this.mState){case ee.unkown:this.mState=ee.countdownAnimPlaying;break;case ee.countdownAnimFinished:this.mState=ee.appearAnimPlaying;break;case ee.appearAnimFinished:this.mState=ee.loopAnimPlaying;break;case ee.loopAnimFinished:"Android"==d.os&&this.scheduleOnce((()=>{this.videoPlayer.node.active=!0}),.1),this.mState=ee.endAnimPlaying}}onVideoPlayFinished(e){if(this.mState!=ee.unkown)if(this.mState==ee.countdownAnimPlaying){this.mState=ee.countdownAnimFinished,_.d(te,"---countDownAnimation finished---"),this.checkIsSelected()||this.showRoleCampView(),this.videoPlayer.node.getComponent(u).top=this.getVideoPlayerTop(),this.videoplayer_bg.node.active=!1,this.playAppearAnimation(),this.showPkProgressBar()}else this.mState==ee.appearAnimPlaying?(this.mState=ee.appearAnimFinished,this.playLoopAnimation(),D.getInstance().startPlay()):this.mState==ee.endAnimPlaying&&(this.mState=ee.endAnimFinished,this.pkEndBorderCtx.node.active=!1,_.d(te,"playEndAnim finished and CLOSE_COCOS"),R.sendToNative(L.CLOSE_COCOS,""))}showPkProgressBar(){let e=this.getPkProgressController();e.showPkProgressUI(),e.bindData(this.roleDataLeft,this.roleDataRight,this.mPkLeftTime)}hidePKProgressBar(){this.getPkProgressController().hidePKProgressUI()}getPkProgressController(){return this.mPkProgressController||(this.mPkProgressController=this.getComponentInChildren(v)),this.mPkProgressController}updatePkProgress(e,t){this.refreshPKVoteInfo(e),this.refreshPkProgress(t)}refreshPKVoteInfo(e){this.getPkProgressController().refreshPKVoteInfo(e)}refreshPkProgress(e){this.getPkProgressController().updatePkProgress(e,((e,t,i)=>{if(this.mIsPkFinished)return;let o=this.initialWidth/2,n=g.canvas.height-this.getProgressViewHeight();"fold_multi_camera"===this.mCameraState&&n<420&&(o=this.initialWidth*n/420/2);let s=(o+e)/o-.5,a=(o+t)/o-.5;this.mRenderEngine.setRealTimeVoteData(s,a,i),this.realTimeMoveVideoPlayer(s)}))}realTimeMoveVideoPlayer(e){this.videoNode.getComponent(p).setAnchorPoint(1-e,.5),this.videoPlayer._impl._forceUpdate=!0,this.videoPlayer._impl.syncMatrix()}playWinnerAvatarAnimation(e){let t=-1==e?this.roleDataLeft.pk_role_img:this.roleDataRight.pk_role_img;if(y.loadRemote(t,((e,t)=>{e?_.d("[RoleItem]","加载头像失败："+e):this.pkEnd.spriteFrame=C.createWithImage(t)})),"fold_multi_camera"===this.mCameraState){let e=this.animNode.getComponent(u),t=g.canvas.height-this.getProgressViewHeight(),i=1152e3/1400,o=(e.bottom-20)*t/i;e.bottom=o;let n=this.pkEndBorderCtx.node.getComponent(p),s=this.pkEndMaskCtx.node.getComponent(p);this.pkEnd.node.getComponent(p).setContentSize(120,120),s.setContentSize(120,120),n.setContentSize(120,120)}else if("fold_single_camera"===this.mCameraState){let e=g.canvas.height,t=this.animNode.getComponent(p).contentSize.height;this.animNode.getComponent(u).bottom=e/2-110-t}let i=this.pkEnd.node.getComponent(p).contentSize.width/2;this.drawCircle(this.pkEndBorderCtx,f.WHITE,12,i);let o=this.pkEndBorderCtx.node.getComponent(k);o.play("pk-end-show"),o.on(k.EventType.FINISHED,(()=>{this.scheduleOnce((()=>{this.hidePKProgressBar(),o.play("pk-end-hide")}),3)}))}drawCircle(e,t,i,o){e.clear(),e.lineWidth=i,e.strokeColor=t,e.circle(0,0,o),e.stroke()}checkIsSelected(){if(!this.mCampList)return!1;let e=this.mCampList[0].camp_selected,t=this.mCampList[1].camp_selected;return e>=0||t>=0}checkIsNeedShowCountdownAnimation(){if(_.d(te,"---checkIsNeedShowCountdownAnimation---"),!this.mCampList)return!0;return 1===this.mCampList[0].showCountDownAnim}getProgressNodeSiblingIndex(){return this.getPkProgressController().viewNode.getSiblingIndex()}getVideoPlayerTop(){return this.getProgressViewHeight()-68}getProgressViewHeight(){return this.getPkProgressController().viewNode.getComponent(p).contentSize.height}}).prototype,"videoplayer_bg",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(U.prototype,"videoNode",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(U.prototype,"prefabs",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j=t(U.prototype,"animNode",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(U.prototype,"pkEnd",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(U.prototype,"pkEndMaskCtx",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(U.prototype,"pkEndBorderCtx",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=U))||H));o._RF.pop()}}}));

System.register("chunks:///_virtual/PkProgressBarLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StringUtils.ts","./LogUtils.ts","./MessageConstants.ts","./NativeBridgeUtils.ts","./DanmakuController.ts"],(function(t){var e,i,o,n,r,s,a,l,h,u,d,g,p,c,f,m,b,L,C,v,w,k,R,D;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){o=t.cclegacy,n=t.Label,r=t.Sprite,s=t.Node,a=t.Graphics,l=t._decorator,h=t.Component,u=t.NodeEventType,d=t.assetManager,g=t.SpriteFrame,p=t.Color,c=t.UITransform,f=t.Animation,m=t.Tween,b=t.tween,L=t.Vec3},function(t){C=t.StringUtils},function(t){v=t.LogUtils},function(t){w=t.MessageType,k=t.MessageConstants},function(t){R=t.NativeBridgeUtils},function(t){D=t.DanmakuController}],execute:function(){var P,y,N,T,S,_,z,B,M,A,I,G,O,U,E,F,x,H,V,K,X,$,W,j,q,J,Q,Y,Z,tt,et,it,ot,nt,rt,st,at,lt,ht,ut,dt,gt,pt,ct,ft,mt,bt,Lt,Ct,vt,wt;o._RF.push({},"42d25edKNpOnLPiB18Fw4Pq","PkProgressBarLayer",void 0);const{ccclass:kt,property:Rt}=l,Dt="PkProgressBarLayer";t("PkProgressBarLayer",(P=kt("PkProgressBarLayer"),y=Rt(n),N=Rt(r),T=Rt(r),S=Rt(s),_=Rt(s),z=Rt(s),B=Rt(r),M=Rt(s),A=Rt(s),I=Rt(s),G=Rt(r),O=Rt(s),U=Rt(r),E=Rt(n),F=Rt(n),x=Rt(n),H=Rt(a),V=Rt(r),K=Rt(n),X=Rt(n),$=Rt(n),W=Rt(a),j=Rt(s),q=Rt(s),P((Y=e((Q=class extends h{constructor(...t){super(...t),i(this,"countDownLabel",Y,this),i(this,"countDownBg",Z,this),i(this,"countDownTag",tt,this),this.timeLeft=0,this.serverTime=0,this.pkEndTime=0,i(this,"progressBgNode",et,this),i(this,"pkProgressNodeLeft",it,this),i(this,"moveMaskLeft",ot,this),i(this,"moveSpriteLeft",nt,this),i(this,"pkCenterTagNode",rt,this),i(this,"pkProgressNodeRight",st,this),i(this,"moveMaskRight",at,this),i(this,"moveSpriteRight",lt,this),i(this,"rightParticle2D",ht,this),i(this,"roleAvatarLeft",ut,this),i(this,"nameLabelLeft",dt,this),i(this,"voteTitleLeft",gt,this),i(this,"voteCountLeft",pt,this),i(this,"roleCtxLeft",ct,this),i(this,"roleAvatarRight",ft,this),i(this,"nameLabelRight",mt,this),i(this,"voteTitleRight",bt,this),i(this,"voteCountRight",Lt,this),i(this,"roleCtxRight",Ct,this),i(this,"leftGuideNode",vt,this),i(this,"rightGuideNode",wt,this),this.mIsPkFinished=!1,this.mProgress=.5,this.roleDataLeft=null,this.roleDataRight=null,this.tweenUpdateInterval=0,this.lastUpdatePointX=1e4}start(){this.initViews()}onLoad(){}initViews(){this.voteTitleLeft.enabled=!1,this.voteCountLeft.enabled=!1,this.voteTitleRight.enabled=!1,this.voteCountRight.enabled=!1,this.moveMaskLeft.active=!1,this.moveMaskRight.active=!1,this.roleCtxLeft.node.on(u.TOUCH_END,this.handleLeftHeadClicked,this),this.roleCtxRight.node.on(u.TOUCH_END,this.handleRightHeadClicked,this)}onDestroy(){this.roleCtxLeft.node.off(u.TOUCH_END,this.handleLeftHeadClicked),this.roleCtxRight.node.off(u.TOUCH_END,this.handleRightHeadClicked)}handleLeftHeadClicked(t){t.propagationStopped=!0;let e=this.roleDataLeft.pk_role_id;v.d(Dt,"---handleLeftHeadClicked---"+e.toString()),R.sendToNative(w.MSG_ON_HEAD_CLICKED,e.toString())}handleRightHeadClicked(t){t.propagationStopped=!0;let e=this.roleDataRight.pk_role_id;v.d(Dt,"---handleLeftHeadClicked---"+e.toString()),R.sendToNative(w.MSG_ON_HEAD_CLICKED,e.toString())}onBindData(t,e){this.roleDataLeft=t,this.roleDataRight=e,v.d(Dt,"---onBindData--- "+this.roleDataLeft.pk_role_name+", "+this.roleDataRight.pk_role_name),this.setupRoleViewInfo(t,this.roleAvatarLeft,this.nameLabelLeft),this.setupRoleViewInfo(e,this.roleAvatarRight,this.nameLabelRight);let i=D.getInstance().config.alpha;this.updateOpacity(i)}setupRoleViewInfo(t,e,i){i.string=t.pk_role_name,d.loadRemote(t.pk_role_img,((t,i)=>{t?v.d("[RoleItem]","加载头像失败："+t):e.spriteFrame=g.createWithImage(i)}))}setupBackgroundColor(t){v.d(Dt,"---setupBackgroundColor: "+t);let e=new p("#0080F5");e.a=t;let i=new p("#8EE4FF");i.a=t,this.setProgressBackgroundGradientColor(this.pkProgressNodeLeft,e,i);let o=new p("#FF85A2");o.a=t;let n=new p("#FF003C");n.a=t,this.setProgressBackgroundGradientColor(this.pkProgressNodeRight,o,n)}setProgressBackgroundGradientColor(t,e,i){let o=t.getComponent(r).customMaterial;o&&(o.setProperty("beginColor",e),o.setProperty("endColor",i))}drawAvatarBorder(t,e){var i=new p(t.pk_font_color);i.a=D.getInstance().config.alpha;let o=e.node.getComponent(c).contentSize.width/2;e.clear(),e.lineWidth=6,e.strokeColor=i,e.circle(0,0,o),e.stroke()}startCountDown(t){this.timeLeft=t;let e=Date.now();this.pkEndTime=e+1e3*t,this.schedule(this.updateCountdown,1)}syncServerTime(t){this.serverTime=t}stopCountdown(){this.timeLeft>=1||(this.countDownLabel.fontSize=60,this.countDownLabel.isBold=!0,this.countDownLabel.string="0",this.countDownLabel.node.setPosition(14,-10),this.unschedule(this.updateCountdown))}updateCountdown(){if(this.timeLeft>0){let t=Date.now(),e=(this.pkEndTime-t)/1e3;if(this.timeLeft=Math.ceil(e),this.timeLeft<=10){this.countDownLabel.fontSize=60,this.countDownLabel.isBold=!0;let t=this.timeLeft>0?this.timeLeft:0;this.countDownLabel.string=""+t,this.countDownLabel.node.getComponent(f).play(),this.countDownLabel.node.setPosition(14,-10)}else this.countDownLabel.string=this.formatTime(this.timeLeft)}else this.stopCountdown(),this.scheduleOnce((()=>{this.exit()}),1)}formatTime(t){let e=Math.floor(t/3600),i=Math.floor(t%3600/60),o=t%60;return`${C.padStart(e.toString(),2,"0")}:${C.padStart(i.toString(),2,"0")}:${C.padStart(o.toString(),2,"0")}`}updatePkProgress(t,e){if(this.mIsPkFinished||this.mProgress==t)return;this.mProgress=t;let i=this.progressBgNode.getComponent(c).width,o=Math.floor(i*(.5-(1-t)));m.stopAll();let n=!0;b(this.pkProgressNodeRight.position).to(1,new L(o,0,0),{onUpdate:(t,r)=>{let s=Math.floor(t.x);(1e4===this.lastUpdatePointX||Math.abs(this.lastUpdatePointX-s/2)>=30)&&(e&&(e(s/2,o/2,n),n=!1),this.lastUpdatePointX=s/2),this.tweenUpdateInterval%5==0?(this.tweenUpdateInterval=0,this.pkProgressNodeLeft.getComponent(c).width=i/2+s,this.moveMaskLeft.getComponent(c).width=i/2+s,this.pkCenterTagNode.position=t,this.pkProgressNodeRight.position=t,this.pkProgressNodeRight.getComponent(c).width=i/2-s,this.moveMaskRight.position=t,this.moveMaskRight.getComponent(c).width=i/2-s,this.rightParticle2D.position=new L(i/2-s,0,0)):this.tweenUpdateInterval++}}).start()}refreshPKVoteInfo(t,e){this.mIsPkFinished||t.c<=0&&e.c<=0||(this.voteTitleLeft.enabled=!0,this.voteCountLeft.enabled=!0,this.voteTitleRight.enabled=!0,this.voteCountRight.enabled=!0,t.id===this.roleDataLeft.pk_role_id?(this.voteTitleLeft.string=t.tl,this.voteCountLeft.string=t.s,this.voteTitleRight.string=e.tl,this.voteCountRight.string=e.s):(this.voteTitleLeft.string=e.tl,this.voteCountLeft.string=e.s,this.voteTitleRight.string=t.tl,this.voteCountRight.string=t.s))}playProgressEndAnimation(t){let e;this.mIsPkFinished=!0,-1===t?(this.moveMaskLeft.active=!0,e=this.moveSpriteLeft.node.getComponent(f)):1===t&&(this.moveMaskRight.active=!0,e=this.moveSpriteRight.node.getComponent(f)),e.play();let i=0;e.on(f.EventType.FINISHED,(()=>{2===i?e.stop():(e.play(),i++)}))}setOpacity(t,e){let i=t.color.clone();i.a=e,t.color=i}updateOpacity(t){v.d(Dt,"updateOpacity: "+t);let e=this.node.getComponent(r);this.setOpacity(e,t),this.setupBackgroundColor(t),this.drawAvatarBorder(this.roleDataLeft,this.roleCtxLeft),this.drawAvatarBorder(this.roleDataRight,this.roleCtxRight)}exit(){this.mIsPkFinished?v.d(Dt,"exit breakup"):(v.d(Dt,"exit without finish message  and CLOSE_COCOS"),R.sendToNative(k.CLOSE_COCOS,""))}showPkGuideAnimation(t){if(!t)return this.startLeftGuideAnimation(),void this.startRightGuideAnimation();t===this.roleDataLeft.pk_role_id?this.startLeftGuideAnimation():this.startRightGuideAnimation()}startLeftGuideAnimation(){this.leftGuideNode.active=!0,this.scheduleOnce((()=>{this.leftGuideNode.active=!1}),3)}startRightGuideAnimation(){this.rightGuideNode.active=!0,this.scheduleOnce((()=>{this.rightGuideNode.active=!1}),3)}}).prototype,"countDownLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(Q.prototype,"countDownBg",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=e(Q.prototype,"countDownTag",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),et=e(Q.prototype,"progressBgNode",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=e(Q.prototype,"pkProgressNodeLeft",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ot=e(Q.prototype,"moveMaskLeft",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nt=e(Q.prototype,"moveSpriteLeft",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rt=e(Q.prototype,"pkCenterTagNode",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=e(Q.prototype,"pkProgressNodeRight",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=e(Q.prototype,"moveMaskRight",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lt=e(Q.prototype,"moveSpriteRight",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ht=e(Q.prototype,"rightParticle2D",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ut=e(Q.prototype,"roleAvatarLeft",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dt=e(Q.prototype,"nameLabelLeft",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gt=e(Q.prototype,"voteTitleLeft",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(Q.prototype,"voteCountLeft",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=e(Q.prototype,"roleCtxLeft",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ft=e(Q.prototype,"roleAvatarRight",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mt=e(Q.prototype,"nameLabelRight",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bt=e(Q.prototype,"voteTitleRight",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lt=e(Q.prototype,"voteCountRight",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ct=e(Q.prototype,"roleCtxRight",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vt=e(Q.prototype,"leftGuideNode",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wt=e(Q.prototype,"rightGuideNode",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=Q))||J));o._RF.pop()}}}));

System.register("chunks:///_virtual/PkProgressController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PkProgressBarLayer.ts"],(function(e){var t,i,o,s,r,n,a,l,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){o=e.cclegacy,s=e.Node,r=e._decorator,n=e.Component,a=e.Sprite,l=e.Animation},function(e){h=e.PkProgressBarLayer}],execute:function(){var p,c,u,v,d;o._RF.push({},"eb1ceaZz0JFUawTmEUxJq1A","PkProgressController",void 0);const{ccclass:w,property:P}=r;e("PkProgressController",(p=w("PkProgressController"),c=P({type:s}),p((d=t((v=class extends n{constructor(...e){super(...e),i(this,"viewNode",d,this),this.view=null,this.updatePkResult=e=>{this.view&&(this.view.stopCountdown(),this.view.playProgressEndAnimation(e))}}onLoad(){this.view=this.node.getComponent(h)}showPkProgressUI(){this.viewNode.active=!0,this.view=this.viewNode.getComponent(h)}hidePKProgressUI(){this.viewNode.getComponent(a).enabled=!1;let e=this.viewNode.getComponent(l);e.on(l.EventType.FINISHED,(()=>{this.viewNode.active=!1})),e.play()}bindData(e,t,i){this.view.onBindData(e,t),this.view.startCountDown(i)}updatePkProgress(e,t){this.view&&this.view.updatePkProgress(e,t)}refreshPKVoteInfo(e){if(this.view){let t=e.roles[0],i=e.roles[1];this.view.refreshPKVoteInfo(t,i),this.view.syncServerTime(e.d)}}updateOpacity(e){this.view?.updateOpacity(e)}showPkGuideAnimation(e){this.view?.showPkGuideAnimation(e)}}).prototype,"viewNode",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=v))||u));o._RF.pop()}}}));

System.register("chunks:///_virtual/PKVoteData.ts",["cc"],(function(t){var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"7c66d7YjnZJd47th9Wd64qn","PKVoteData",void 0);t("RoleVoteData",class{constructor(){this.id=void 0,this.c=void 0,this.s=void 0,this.tl=void 0}});t("PKVoteData",class{constructor(){this.t=void 0,this.id=void 0,this.d=void 0,this.roles=void 0}}),i._RF.pop()}}}));

System.register("chunks:///_virtual/PraiseAnimation.ts",["cc"],(function(t){var n,i,s,e;return{setters:[function(t){n=t.cclegacy,i=t._decorator,s=t.Component,e=t.Animation}],execute:function(){var a,o;n._RF.push({},"434a4nr5UZGbJ3npHk2+djT","PraiseAnimation",void 0);const{ccclass:c,property:r}=i;t("PraiseAnimation",c("PraiseAnimation")(((o=class t extends s{constructor(...t){super(...t),this.mPlaying=!1}start(){t._instance=this}static getInstance(){return this._instance}play(t){null==t||this.mPlaying||(this.mPlaying=!0,this.node.getComponent(e).play())}stop(){this.mPlaying&&(this.mPlaying=!1,this.node.getComponent(e).stop())}})._instance=null,a=o))||a);n._RF.pop()}}}));

System.register("chunks:///_virtual/ReourceUtils.ts",["cc","./LogUtils.ts"],(function(e){var s,t,c,o;return{setters:[function(e){s=e.cclegacy,t=e.resources,c=e.VideoClip},function(e){o=e.LogUtils}],execute:function(){s._RF.push({},"ed023JcdZ1MpaX4CH/EVmmS","ReourceUtils",void 0);e("ResourceUtils",class{static loadVideoResource(e,s){t.load(e,c,((t,c)=>{t?o.d("[ResourceUtils]","加载视频: "+e+", 失败："+t):s(c)}))}}),s._RF.pop()}}}));

System.register("chunks:///_virtual/RoleCampData.ts",["cc"],(function(t){var o;return{setters:[function(t){o=t.cclegacy}],execute:function(){o._RF.push({},"0958feWC7xOuqdHr8/M+EYg","RoleCampData",void 0);t("RoleCampData",class{constructor(){this.pk_id=void 0,this.pk_role_id=void 0,this.pk_font_color=void 0,this.pk_role_dt=void 0,this.pk_role_img=void 0,this.pk_role_name=void 0,this.pk_role_content=void 0,this.duration=void 0,this.camp_selected=-1,this.showCountDownAnim=-1}}),o._RF.pop()}}}));

System.register("chunks:///_virtual/RoleCampLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MessageConstants.ts","./LogUtils.ts","./MessageCenter.ts","./StringUtils.ts","./DanmakuController.ts","./KvStorage.ts"],(function(e){var t,i,o,n,r,l,a,s,h,u,c,p,f,g,m,d,b,C,L,R,_,y,N,S;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){o=e.cclegacy,n=e.Node,r=e.Graphics,l=e.Sprite,a=e.Label,s=e.Button,h=e._decorator,u=e.Component,c=e.NodeEventType,p=e.Animation,f=e.assetManager,g=e.SpriteFrame,m=e.Color,d=e.UITransform,b=e.native},function(e){C=e.MessageConstants,L=e.MessageType},function(e){R=e.LogUtils},function(e){_=e.MessageCenter},function(e){y=e.StringUtils},function(e){N=e.DanmakuController},function(e){S=e.KvStorage}],execute:function(){var E,w,v,D,k,A,z,I,T,M,O,x,F,P,U,B,K,G,H,V,W,j,J,Y,q,Q,X,Z,$,ee,te;o._RF.push({},"927f3aV1GxNwKhuPgMPe8xn","RoleCampLayer",void 0);const{ccclass:ie,property:oe}=h,ne="RoleCampLayer";e("RoleCampLayer",(E=ie("RoleCampLayer"),w=oe(n),v=oe(n),D=oe(r),k=oe(l),A=oe(a),z=oe(s),I=oe(n),T=oe(n),M=oe(r),O=oe(l),x=oe(a),F=oe(s),P=oe(n),U=oe(n),E((G=t((K=class extends u{constructor(...e){super(...e),i(this,"leftCampNode",G,this),i(this,"roleLeft",H,this),i(this,"roleCtxLeft",V,this),i(this,"roleAvatarLeft",W,this),i(this,"roleNameLeft",j,this),i(this,"btnSelectRoleLeft",J,this),i(this,"rightCampNode",Y,this),i(this,"roleRight",q,this),i(this,"roleCtxRight",Q,this),i(this,"roleAvatarRight",X,this),i(this,"roleNameRight",Z,this),i(this,"btnSelectRoleRight",$,this),i(this,"flashNode",ee,this),i(this,"closeNode",te,this),this.flipFromLeftAnimation=null,this.flipFromRightAnimation=null,this.bounceAnimation=null,this.roleDataLeft=null,this.roleDataRight=null}onLoad(){R.d(ne,"---onLoad---"),this.btnSelectRoleLeft.node.on(c.TOUCH_END,this.onClick,this),this.btnSelectRoleRight.node.on(c.TOUCH_END,this.onClick,this),this.closeNode.on(c.TOUCH_END,this.onCloseClicked,this),this.flipFromLeftAnimation=this.leftCampNode.getComponent(p),this.flipFromRightAnimation=this.rightCampNode.getComponent(p),this.bounceAnimation=this.flashNode.getComponent(p),this.flashNode.active=!1,this.flipFromLeftAnimation.on(p.EventType.FINISHED,(()=>{this.flashNode.active=!0,this.bounceAnimation.play()}))}onBindData(e,t){R.d(ne,"---onBindData---"),this.roleDataLeft=e,this.roleDataRight=t,this.setupRoleViewInfo(e,this.roleAvatarLeft,this.roleNameLeft),this.setupRoleViewInfo(t,this.roleAvatarRight,this.roleNameRight);let i=N.getInstance().config.alpha;this.updateOpacity(i)}setupRoleViewInfo(e,t,i){R.d(ne,"---setupRoleViewInfo---"),i.string=y.clamp(e.pk_role_name,5),f.loadRemote(e.pk_role_img,((e,i)=>{e?R.d("[RoleItem]","加载头像失败："+e):t.spriteFrame=g.createWithImage(i)}))}drawAvatarBorder(e,t){var i=new m(e.pk_font_color);i.a=N.getInstance().config.alpha;let o=t.node.getComponent(d).contentSize.width/2;t.clear(),t.lineWidth=6,t.strokeColor=i,t.circle(0,0,o),t.stroke()}setOpacity(e,t){let i=e.color.clone();i.a=t,e.color=i}updateOpacity(e){let t=this.node.getComponent(l);this.setOpacity(t,e),this.drawAvatarBorder(this.roleDataLeft,this.roleCtxLeft),this.drawAvatarBorder(this.roleDataRight,this.roleCtxRight)}onClick(e){R.d(ne,"---onclick---"),e.propagationStopped=!0;let t="select_btn_left"===e.currentTarget.name?this.roleDataLeft:this.roleDataRight;if(_.getInstance().emit(C.PK_ROLE_SELECTED_MSG,t.pk_role_id),b.bridge){let e={pk_role_id:t.pk_role_id,pk_id:t.pk_id};b.bridge.sendToNative(L.MSG_SELECT_ROLE,JSON.stringify(e))}S.getInstance().setItem(S.KEY_PK_SELECTED_ROLE,t.pk_role_id)}onCloseClicked(e){R.d(ne,"---onCloseClicked---"),e.propagationStopped=!0,_.getInstance().emit(C.PK_ROLE_SELECTED_MSG),b.bridge&&b.bridge.sendToNative(L.MSG_CLOSE_CAMP_SELECT_PANEL,"")}}).prototype,"leftCampNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(K.prototype,"roleLeft",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(K.prototype,"roleCtxLeft",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(K.prototype,"roleAvatarLeft",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(K.prototype,"roleNameLeft",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(K.prototype,"btnSelectRoleLeft",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(K.prototype,"rightCampNode",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(K.prototype,"roleRight",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(K.prototype,"roleCtxRight",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(K.prototype,"roleAvatarRight",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(K.prototype,"roleNameRight",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(K.prototype,"btnSelectRoleRight",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=t(K.prototype,"flashNode",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=t(K.prototype,"closeNode",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=K))||B));o._RF.pop()}}}));

System.register("chunks:///_virtual/RootController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MessageConstants.ts","./LogUtils.ts","./DanmakuFeedbackDialogController.ts","./DanmakuUtils.ts","./NativeMessageHandler.ts"],(function(e){var t,o,n,i,r,s,l,a,c,u,d,C,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.initializerDefineProperty},function(e){n=e.cclegacy,i=e.native,r=e.Node,s=e._decorator,l=e.Component,a=e.NodeEventType},function(e){c=e.MessageType},function(e){u=e.LogUtils},function(e){d=e.DanmakuFeedbackDialogController},function(e){C=e.DanmakuUtils},function(e){g=e.NativeMessageHandler}],execute:function(){var p,v,f,m,N;n._RF.push({},"f4a76xu8mBKmrQju9CgkxPi","RootController",void 0);const{ccclass:h,property:k}=s;var b=C.isClientSupported();let D=new g;cc.nativeCallCocos=function(e,t,o){b&&D.handleNativeCmd(e,t,o)},i.bridge&&(i.bridge.onNative=(e,t)=>{b&&D.handleNativeCmd(e,t,"")});e("RootController",(p=h("RootController"),v=k(r),p((N=t((m=class extends l{constructor(...e){super(...e),o(this,"rootNode",N,this),this.mClickListener=null}start(){this.mClickListener=e=>{this.onClick(e)},this.rootNode.on(a.TOUCH_END,this.mClickListener)}onClick(e){u.d("RootController","点击空白区域"),d.getInstance().isShowing()?(d.getInstance().hide(),i.bridge&&i.bridge.sendToNative(c.MSG_CLICK,"")):i.bridge&&i.bridge.sendToNative(c.MSG_TOGGLE_CONTROL,"")}}).prototype,"rootNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=m))||f));n._RF.pop()}}}));

System.register("chunks:///_virtual/RoundRectMask.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,s,i,r,a,o,n,u,p,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,s=t.initializerDefineProperty},function(t){i=t.cclegacy,r=t.macro,a=t.Mask,o=t._decorator,n=t.Component,u=t.UITransform,p=t.game,c=t.Game}],execute:function(){var h,d,l,m,k,_,g,y,R,M;i._RF.push({},"2026aP0A0pOoKgkI191Xgor","RoundRectMask",void 0);const{ccclass:f,property:w,executeInEditMode:D,disallowMultiple:E,requireComponent:b,menu:A}=o;r.ENABLE_WEBGL_ANTIALIAS=!0;t("RoundRectMask",(h=f(),d=D(!0),l=E(!0),m=b(a),k=A("渲染组件/圆角遮罩"),_=w(),g=w({tooltip:"圆角半径:\n0-1之间为最小边长比例值, \n>1为具体像素值"}),h(y=d(y=l(y=m(y=k((M=e((R=class extends n{constructor(...t){super(...t),s(this,"_radius",M,this),this.mask=null}get radius(){return this._radius}set radius(t){this._radius=t,this.updateMask(t)}onEnable(){this.mask=this.getComponent(a),this.updateMask(this.radius)}updateMask(t){let e=t>=0?t:0;if(e<1){let t=this.node.getComponent(u);e=Math.min(t.width,t.height)*e}this.mask.radius=e,this.mask.onDraw=this.onDraw.bind(this.mask),this.mask._updateGraphics=this._updateGraphics.bind(this.mask),this.mask.type=a.Type.GRAPHICS_RECT}_updateGraphics(){let t=this._graphics;t&&this.onDraw(t)}onDraw(t){t.clear();let e=this.node.getComponent(u),s=e.width,i=e.height,r=-s*e.anchorX,a=-i*e.anchorY;t.roundRect(r,a,s,i,this.radius||0),p.renderType===c.RENDER_TYPE_CANVAS?t.stroke():t.fill()}}).prototype,"_radius",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),e(R.prototype,"radius",[g],Object.getOwnPropertyDescriptor(R.prototype,"radius"),R.prototype),y=R))||y)||y)||y)||y)||y));i._RF.pop()}}}));

System.register("chunks:///_virtual/ScrollLayer.ts",["cc","./ScrollLine.ts","./DanmakuData.ts","./BaseRenderLayer.ts"],(function(t){var e,i,n,s,r,h,l;return{setters:[function(t){e=t.cclegacy,i=t.UITransform,n=t._decorator},function(t){s=t.ScrollLine},function(t){r=t.LAYER_TYPE_SCROLL,h=t.danmaDirection},function(t){l=t.BaseRenderLayer}],execute:function(){var o;e._RF.push({},"c832bwxh/tHzJl9lRcu65VZ","ScrollLayer",void 0);const{ccclass:a,property:m}=n;t("ScrollLayer",a("ScrollLayer")(o=class extends l{constructor(...t){super(...t),this.mLines=new Array,this.mBufferItems=new Array,this.mTotalDanmakuCountInLayer=0,this.roleCampData=void 0}getLayerType(){return r}getDirection(){return this.name.startsWith("scrolllayer_left")?h.L_TO_R:h.R_TO_L}configLines(){let t=this.mController.config.lineCount;for(let e=0;e<t;e++){let t=new s(this.mController,this);this.mLines.push(t);let i=this.mHeight/2-0;t.line=e;let n=this.mController.config.lineHeight,r=i-e*(n+this.mController.config.lineMargin);t.onLayoutChanged(this.mWidth,n,0,r)}}relayoutLines(){let t=this.mController.config.lineCount,e=this.mController.config.lineHeight,i=this.mController.config.lineMargin;if(t<this.mLines.length){let e=this.mLines.length-t;for(let t=0;t<e;t++){this.mLines.splice(this.mLines.length-1,1).forEach((t=>{t.clear()}))}}else{let e=t-this.mLines.length;for(let t=0;t<e;t++)this.mLines.push(new s(this.mController,this))}for(let t=0;t<this.mLines.length;t++){let n=this.mLines[t],s=this.mHeight/2-0-t*(e+i);n.line=t,n.onLayoutChanged(this.mWidth,e,0,s)}}start(){let t=this.node.getComponent(i);this.mInitWidth=this.mWidth=t.contentSize.width,this.mInitHeight=this.mHeight=t.contentSize.height,this.configLines()}onLayoutSizeChanged(t,e){-1!=t&&(this.mWidth=t),-1!=e&&(this.mHeight=e),this.relayoutLines()}addItems(t,e){for(let t=e.length-1;t>=0;t--){let i=e[t];i.getData().isSelfSent&&(this.mBufferItems.push(i),e.splice(t,1))}this.mBufferItems=[...e,...this.mBufferItems]}typesetting(t,e,i){for(let e=this.mBufferItems.length-1;e>=0;e--){let i=this.mBufferItems[e];if(this.distributeItemToLines(t,i))this.mBufferItems.splice(e,1);else if(i.getData().isSelfSent)break}return this.mTotalDanmakuCountInLayer=0,this.mLines.forEach((n=>{this.mTotalDanmakuCountInLayer+=n.typesetting(t,e,i)})),this.mTotalDanmakuCountInLayer}distributeItemToLines(t,e){this.mLines.sort(((t,e)=>t.getDrawingCount()-e.getDrawingCount()));for(let i=0;i<this.mLines.length;i++){let n=this.mLines[i];if(n.addItem(t,e))return e.line=n.line,!0}return!1}clear(){this.mLines.forEach((t=>{t.clear()})),this.mBufferItems=[]}updateOpacity(t){this.mBufferItems.forEach((e=>{e.setOpacity(t)})),this.mLines.forEach((e=>{e?.updateOpacity(t)}))}getRoleCampData(t){return this.roleCampData&&t===this.roleCampData.pk_id||(this.roleCampData=this.mController.getRoleCampData(this.getDirection())),this.roleCampData}getInitialWidth(){return this.mInitWidth}getInitialHeight(){return this.mInitHeight}updateLayerContentSize(t,e){if(t==this.mWidth&&e==this.mHeight)return;-1!=t&&(this.mWidth=t),-1!=e&&(this.mHeight=e);let i=this.mController.config.lineHeight,n=this.mController.config.lineMargin;for(let t=0;t<this.mLines.length;t++){let e=this.mLines[t],s=this.mHeight/2-0-t*(i+n);e.line=t,e.onLayoutChanged(this.mWidth,i,0,s)}}})||o);e._RF.pop()}}}));

System.register("chunks:///_virtual/ScrollLine.ts",["cc","./DanmakuData.ts"],(function(t){var e,i;return{setters:[function(t){e=t.cclegacy},function(t){i=t.danmaDirection}],execute:function(){e._RF.push({},"3ccd1SfnSNAa6n8d4xwRrDH","ScrollLine",void 0);t("ScrollLine",class{constructor(t,e){this.mDrawingItems=new Array,this.config=void 0,this.mLayer=void 0,this.controller=void 0,this.width=void 0,this.y=void 0,this.x=void 0,this.line=-1,this.controller=t,this.config=t.config,this.mLayer=e}getDrawingCount(){return this.mDrawingItems.length}onLayoutChanged(t,e,i,s){this.width=t,this.y=s,this.x=i}addItem(t,e){let s=null;for(let t=0;t<this.mDrawingItems.length;t++)null==s?s=this.mDrawingItems[t]:s.direction==i.R_TO_L?this.mDrawingItems[t].getX()>s.getX()&&(s=this.mDrawingItems[t]):this.mDrawingItems[t].getX()<s.getX()&&(s=this.mDrawingItems[t]);return!(null!=s&&!this.hasEnoughSpace(s,e))&&(this.mDrawingItems.push(e),this.resetDrawItem(e),this.mLayer.getRootNode().addChild(e.node),!0)}hasEnoughSpace(t,e){let s=0,n=t.getX(),r=t.getWidth();if(s=t.direction==i.L_TO_R?n:-1*n-r,s<0||s<this.config.itemMargin)return!1;let h=Math.abs(this.getItemSpeed(t)),a=Math.abs(this.getItemSpeed(e));return h>a||s-(a-h)*(this.config.moveTime/1e3)>=this.config.itemMargin}resetDrawItem(t){t.node.active=!0;let e=t.node.getPosition();e.x=this.x,t.direction==i.L_TO_R&&(e.x-=t.getWidth()),e.y=this.y,t.node.setPosition(e)}typesetting(t,e,i){if(e){this.mDrawingItems.forEach((t=>{if(!t.isPaused){let e=t.getX()+this.getItemSpeed(t)*i;t.setX(e),t.showDuration+=i}}));for(let t=this.mDrawingItems.length-1;t>=0;t--){let e=this.mDrawingItems[t];(e.toRemove||this.isOutOfScreen(e))&&(this.mLayer.releaseItem(e),this.mDrawingItems.splice(t,1))}}return this.mDrawingItems.length}isOutOfScreen(t){return t.direction===i.R_TO_L?t.getX()+t.getWidth()<-1*this.width:t.getX()>this.width}arriveBoundary(t){return t.direction===i.R_TO_L?t.getX()<=-1*this.width:t.getX()+t.getWidth()>=this.width}getItemSpeed(t){return(t.getWidth()+this.width)/this.config.moveTime*1e3*t.direction}clear(){this.mDrawingItems.forEach((t=>{this.mLayer.releaseItem(t)})),this.mDrawingItems=[]}updateOpacity(t){this.mDrawingItems.forEach((e=>{e?.setOpacity(t)}))}}),e._RF.pop()}}}));

System.register("chunks:///_virtual/SimpleTest.ts",["cc","./DanmakuData.ts","./DanmakuController.ts","./RoleCampData.ts","./PKVoteData.ts","./MessageCenter.ts","./MessageConstants.ts","./NumberUtils.ts","./LogUtils.ts"],(function(t){var e,s,o,a,n,i,l,r,c,p,m,u,h;return{setters:[function(t){e=t.cclegacy,s=t.Component,o=t._decorator},function(t){a=t.DanmakuData},function(t){n=t.DanmakuController},function(t){i=t.RoleCampData},function(t){l=t.PKVoteData,r=t.RoleVoteData},function(t){c=t.MessageCenter},function(t){p=t.MessageConstants,m=t.ActionType},function(t){u=t.NumberUtils},function(t){h=t.LogUtils}],execute:function(){var _;e._RF.push({},"c6a0cozRz9KpYSacHtl+4eX","SimpleTest",void 0);const{ccclass:d,property:g}=o;t("SimpleTest",d("SimpleTest")(_=class extends s{constructor(...t){super(...t),this.flag=!0,this.pkTime=30,this.mVote1=0,this.mVote2=0}onLoad(){}start(){h.d("SimpleTest"," start"),n.getInstance().setRoleCampList(this.buildRoleCampData()),n.getInstance().startPlay(1721721660342);let t=()=>{c.getInstance().emit(p.PK_SYNC_MSG,this.buildVoteData())};this.schedule(t,1,this.pkTime,1),this.scheduleOnce((()=>{c.getInstance().emit(p.PK_FINISH_MSG,this.buildVoteData()),this.unschedule(t)}),this.pkTime),this.schedule((()=>{let t=this.buildDanmakuData();n.getInstance().appendData(t),n.getInstance().updateTime(1721721660342)}),1),n.getInstance().startPlay(1721721660342),this.scheduleOnce((()=>{c.getInstance().emit(m.ACTION_SHOW_PK_GUIDE,JSON.stringify({pk_role_id:"6"}))}),10)}buildVoteData(){this.pkTime--;let t=n.getInstance().getRoleCampList();if(!t||0==t.length)return null;let e=t[0],s=t[1],o=new l;o.id=e.pk_id;let a=[];this.mVote1+=u.getRandomInt(0,10),this.mVote2+=u.getRandomInt(0,10);let i=new r;i.id=e.pk_role_id,i.c=this.mVote1,i.tl="弹幕数: ",i.s=""+i.c/(this.mVote1+this.mVote2),a.push(i);let c=new r;return c.id=s.pk_role_id,c.c=this.mVote2,c.tl=" :弹幕数",c.s=""+c.c/(this.mVote1+this.mVote2),a.push(c),o.roles=a,o.d=this.pkTime,JSON.stringify(o)}buildDanmakuData(){let t=["厉害了厉害了厉害了厉害了","爷青回爷青回爷青回爷青回","前方高能预警","我从未见过有如此厚颜无耻之人我从未见过有如此厚颜无耻之人我从未见过有如此厚颜无耻之人"],e=new Array;for(let s=0;s<5;s++){let o=new a;o.showAtTime=1721721660342,o.layerType=1001,o.type=Math.floor(10*Math.random())%3;let n=Math.floor(Math.random()*t.length);o.avatar=n%2==0?"https://ossimg.hitv.com/platform_oss/B8BCA868537C4394AB831F3221E8828E.png?x-oss-process=image/resize,m_fixed,w_120,h_120":"",o.content=t[n]+s,o.drawType=1001,o.pk_id=5,s%2==0?(o.font_color="#01B2EA",o.pk_role_id=6):(o.font_color="#FF2A4A",o.pk_role_id=7),o.v2_up_count=Math.floor(150*Math.random()),o.v2_up_count>100&&(o.up_out=1),e.push(o)}return e}buildRoleCampData(){let t=new Array;for(let e=0;e<2;e++){let s=new i;s.pk_role_id=0==e?7:6,s.pk_role_dt=e+1,s.pk_role_img="https://ossimg.hitv.com/platform_oss/F03990F189494621AAB091FF5EF68017.png",s.pk_role_name=0===e?"古力娜扎哈哈":"迪丽热巴拉拉",s.pk_role_name=0===e?"古力娜扎哈哈":"迪丽热巴拉拉",s.pk_font_color=0===e?"#01B2EA":"#FF2A4A",s.pk_id=5,s.duration=20,s.camp_selected=-1,s.duration=30,s.showCountDownAnim=1,t.push(s)}return h.d("SimpleTest",JSON.stringify(t)),t}})||_);e._RF.pop()}}}));

System.register("chunks:///_virtual/StringUtils.ts",["cc"],(function(t){var r;return{setters:[function(t){r=t.cclegacy}],execute:function(){r._RF.push({},"b21ef8sBzhNE7ot/AN5t3/p","StringUtils",void 0);t("StringUtils",class{static clamp(t,r=30){return t.length>r&&(t=t.slice(0,r-2)+"···"),t}static padStart(t,r,e){var n="",s=r-t.length;if(s>0){var i=Math.floor(s/e.length),c="";s%e.length!=0&&(c=e.substring(0,s%e.length));for(var l=0;l<i;l++)n+=e;n+=c}return n+t}}),r._RF.pop()}}}));

System.register("chunks:///_virtual/TextDrawItem.ts",["cc","./DrawItem.ts","./StringUtils.ts","./ColorUtils.ts","./DanmakuController.ts"],(function(t){var e,o,n,r,s,i,c,l;return{setters:[function(t){e=t.cclegacy,o=t.Label,n=t.Color,r=t._decorator},function(t){s=t.DrawItem},function(t){i=t.StringUtils},function(t){c=t.ColorUtils},function(t){l=t.DanmakuController}],execute:function(){var a;e._RF.push({},"12729BrbDtAm631vMDfk2LD","TextDrawItem",void 0);const{ccclass:m,property:u}=r;t("TextDrawItem",m("TextDrawItem")(a=class extends s{constructor(...t){super(...t),this.mText=null}onBindData(t){this.mText||(this.mText=this.getComponent(o)),this.mText.color=c.fixedColor(n.WHITE,t.font_color),this.mText.string=i.clamp(t.content),this.mText.fontSize=l.getInstance().config.fontSize}setOpacity(t){let e=this.mText.color.clone();e.a=t,this.mText.color=e}onLoad(){this.mText=this.getComponent(o)}})||a);e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});